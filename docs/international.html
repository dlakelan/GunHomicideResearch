<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>International Crime and Firearms Analysis – international</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">International Crime and Firearms Analysis</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="dropdown-header">
 <span class="menu-text">about.qmd</span></li>
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#comparisons-of-international-homicide-and-gun-ownership" id="toc-comparisons-of-international-homicide-and-gun-ownership" class="nav-link active" data-scroll-target="#comparisons-of-international-homicide-and-gun-ownership">Comparisons of International Homicide and Gun Ownership</a></li>
  <li><a href="#how-do-countries-compare-regarding-homicides-suicides-and-guns" id="toc-how-do-countries-compare-regarding-homicides-suicides-and-guns" class="nav-link" data-scroll-target="#how-do-countries-compare-regarding-homicides-suicides-and-guns">How do countries compare regarding homicides, suicides, and guns</a></li>
  <li><a href="#homicide-increases-exponentially-with-increasing-gini-coefficient" id="toc-homicide-increases-exponentially-with-increasing-gini-coefficient" class="nav-link" data-scroll-target="#homicide-increases-exponentially-with-increasing-gini-coefficient">Homicide increases exponentially with increasing Gini coefficient</a></li>
  <li><a href="#how-much-does-firearms-ownership-matter" id="toc-how-much-does-firearms-ownership-matter" class="nav-link" data-scroll-target="#how-much-does-firearms-ownership-matter">How much does firearms ownership matter?</a></li>
  <li><a href="#trying-to-use-smallarmssurvey.org-data" id="toc-trying-to-use-smallarmssurvey.org-data" class="nav-link" data-scroll-target="#trying-to-use-smallarmssurvey.org-data">Trying to use SmallArmsSurvey.org data</a></li>
  <li><a href="#who-has-suicide-data" id="toc-who-has-suicide-data" class="nav-link" data-scroll-target="#who-has-suicide-data">WHO has suicide data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="comparisons-of-international-homicide-and-gun-ownership" class="level1">
<h1>Comparisons of International Homicide and Gun Ownership</h1>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">activate</span>(<span class="st">"."</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CSV</span>,<span class="bu">DataFrames</span>,<span class="bu">Downloads</span>,<span class="bu">DataFramesMeta</span>, <span class="bu">StatsPlots</span>, <span class="bu">XLSX</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Dates</span>, <span class="bu">Statistics</span>, <span class="bu">Turing</span>, <span class="bu">LinearAlgebra</span>, <span class="bu">Interpolations</span>, <span class="bu">Serialization</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">GLM</span>, <span class="bu">Colors</span>, <span class="bu">ColorSchemes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  Activating project at `~/Consulting/LakelandAppliedSciLLC/CriminologyGuns`</code></pre>
</div>
</div>
</section>
<section id="how-do-countries-compare-regarding-homicides-suicides-and-guns" class="level1">
<h1>How do countries compare regarding homicides, suicides, and guns</h1>
<p>We can access homicide data from the UN, economic data from WorldBank, and Suicide data from WHO.</p>
<p>In addition, for comparisons across states in the US, to understand if international patterns repeat in cross-state comparisons, we can use the Census ACS.</p>
<p>Let’s get some data and put it together.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getifnotthere</span>(filename,URL)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> !<span class="bu">Base</span>.Filesystem.<span class="fu">ispath</span>(filename)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># see https://www.aic.gov.au/statistics/homicide</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Downloads</span>.<span class="fu">download</span>(URL,filename)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">getifnotthere</span>(<span class="st">"data/intl-homicides-unodc.xlsx"</span>,<span class="st">"https://dataunodc.un.org/sites/dataunodc.un.org/files/data_cts_intentional_homicide.xlsx"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">getifnotthere</span>(<span class="st">"data/country-populations-unpop.xlsx"</span>,<span class="st">"https://population.un.org/wpp/Download/Files/1_Indicators%20(Standard)/EXCEL_FILES/1_General/WPP2022_GEN_F01_DEMOGRAPHIC_INDICATORS_COMPACT_REV1.xlsx"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>homdata <span class="op">=</span> <span class="fu">DataFrame</span>(XLSX.<span class="fu">readtable</span>(<span class="st">"./data/intl-homicides-unodc.xlsx"</span>,<span class="fl">1</span>; first_row<span class="op">=</span><span class="fl">3</span>)<span class="op">...</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rename!</span>(homdata,<span class="fu">Dict</span>(<span class="fu">Symbol</span>(<span class="st">"Unit of measurement"</span>) <span class="op">=&gt;</span> <span class="op">:</span>units, <span class="op">:</span>VALUE <span class="op">=&gt;</span> <span class="op">:</span>homicide))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="pp">@subset</span>!(homdata,<span class="op">:</span>Indicator <span class="op">.==</span> <span class="st">"Victims of intentional homicide"</span> <span class="op">.&amp;&amp;</span> <span class="op">:</span>Dimension <span class="op">.==</span> <span class="st">"Total"</span> <span class="op">.&amp;&amp;</span> <span class="op">:</span>Sex <span class="op">.==</span> <span class="st">"Total"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>popdata <span class="op">=</span> <span class="fu">DataFrame</span>(XLSX.<span class="fu">readtable</span>(<span class="st">"./data/country-populations-unpop.xlsx"</span>,<span class="fl">1</span>,<span class="st">"A:BM"</span>; first_row<span class="op">=</span><span class="fl">17</span>)<span class="op">...</span>) </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rename!</span>(popdata,<span class="fu">Dict</span>(<span class="fu">Symbol</span>(<span class="st">"ISO3 Alpha-code"</span>) <span class="op">=&gt;</span> <span class="op">:</span>Iso3_code, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Symbol</span>(<span class="st">"Region, subregion, country or area *"</span>) <span class="op">=&gt;</span> <span class="op">:</span>country,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Symbol</span>(<span class="st">"Total Population, as of 1 January (thousands)"</span>) <span class="op">=&gt;</span> <span class="op">:</span>PopulationJan,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Symbol</span>(<span class="st">"Population Density, as of 1 July (persons per square km)"</span>) <span class="op">=&gt;</span> <span class="op">:</span>popdensperkm2,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Symbol</span>(<span class="st">"Median Age, as of 1 July (years)"</span>) <span class="op">=&gt;</span> <span class="op">:</span>medianage))</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="pp">@rtransform</span>!(popdata,<span class="op">:</span>PopulationJan <span class="op">=</span> <span class="cf">if</span> <span class="op">:</span>PopulationJan <span class="op">==</span> <span class="st">"..."</span> <span class="cn">missing</span> <span class="cf">else</span> <span class="op">:</span>PopulationJan <span class="op">.*</span> <span class="fl">1000.0</span> <span class="cf">end</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>countrycodes <span class="op">=</span> <span class="fu">unique</span>(<span class="pp">@select</span>(popdata,<span class="op">:</span>country,<span class="op">:</span>Iso3_code))</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>alldat <span class="op">=</span> <span class="pp">@orderby</span>(<span class="pp">@subset</span>(<span class="fu">leftjoin</span>(homdata,popdata; on <span class="op">=</span> [<span class="op">:</span>Iso3_code,<span class="op">:</span>Year],matchmissing<span class="op">=:</span>notequal),</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>units <span class="op">.==</span> <span class="st">"Counts"</span>), <span class="op">:</span>Iso3_code,<span class="op">:</span>Year)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co">## plot comparisons for countries with 3M people by region</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>bigcount <span class="op">=</span> <span class="pp">@subset</span>(alldat,<span class="op">:</span>PopulationJan <span class="op">.&gt;</span> <span class="fl">3e6</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> p <span class="op">=</span> []</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> <span class="fu">unique</span>(bigcount.Region)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        dat <span class="op">=</span> <span class="pp">@subset</span>(bigcount,<span class="op">:</span>Region <span class="op">.==</span> r)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(p,<span class="fu">plot</span>(dat.Year,<span class="fu">log</span>.(dat.homicide <span class="op">./</span> dat.PopulationJan <span class="op">.*</span> <span class="fl">100000.0</span>); group<span class="op">=</span>dat.Iso3_code, title<span class="op">=</span><span class="st">"log(Homicide Rate)</span><span class="sc">\n$</span>r<span class="st">"</span>,legend<span class="op">=</span><span class="cn">false</span>,ylim<span class="op">=</span>(<span class="fu">log</span>(<span class="fl">0.1</span>),<span class="fu">log</span>(<span class="fl">150.0</span>))))</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(p<span class="op">...</span>)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<p><img src="international_files/figure-html/cell-3-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>As we see from these plots, homicide rates vary over multiple orders of magnitude. These range from around 0.1 (log(0.1) = -2.3) to over 100 homicides/100k/yr (log(100) = 4.6).</p>
<p>In graphs mentioning logarithms remember that each increase of 1 unit implies that the original quantity was <strong>multiplied</strong> by a factor of <code>e = 2.718...</code></p>
<p>Why do homicide rate vary over so many orders of magnitude from place to place?</p>
<p>It turns out that economic conditions are a powerful explanatory variable. In particular, measures of inequality in the income distribution.</p>
<p>The <a href="https://en.wikipedia.org/wiki/Gini_coefficient">Gini coefficient</a> can be thought of as the average size of the difference between two randomly selected people’s incomes for the region in question. This average size is then normalized to 2x the average size to produce a dimensionless ratio describing the variation in income in the region as a fraction of the average. In this case, due to the formula, the Gini coefficient can be between 0 and 1 or is usually rescaled to 0 to 100.</p>
<p>Explaining the multiple orders of magnitude is easier when we discover that Homicide rate varies exponentially with Gini coefficient. Although we would still prefer a mechanistic explanation just verifying this association is useful.</p>
</section>
<section id="homicide-increases-exponentially-with-increasing-gini-coefficient" class="level1">
<h1>Homicide increases exponentially with increasing Gini coefficient</h1>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getifnotthere</span>(<span class="st">"data/worldbank-gini-data.zip"</span>,<span class="st">"https://api.worldbank.org/v2/en/indicator/SI.POV.GINI?downloadformat=csv"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>ginidat <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"data/API_SI.POV.GINI_DS2_en_csv_v2_4333947.csv"</span>,DataFrame; skipto<span class="op">=</span><span class="fl">6</span>, header<span class="op">=</span><span class="fl">5</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>ginidat <span class="op">=</span> ginidat[<span class="op">:</span>,<span class="fl">1</span><span class="op">:</span><span class="kw">end</span><span class="op">-</span><span class="fl">1</span>] <span class="co"># drop meaningless final column</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rename!</span>(ginidat,<span class="fu">Dict</span>(<span class="fu">Symbol</span>(<span class="st">"Country Name"</span>) <span class="op">=&gt;</span> <span class="op">:</span>Country, <span class="fu">Symbol</span>(<span class="st">"Country Code"</span>) <span class="op">=&gt;</span> <span class="op">:</span>countrycode, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Symbol</span>(<span class="st">"Indicator Name"</span>) <span class="op">=&gt;</span> <span class="op">:</span>indicator, <span class="fu">Symbol</span>(<span class="st">"Indicator Code"</span>) <span class="op">=&gt;</span> <span class="op">:</span>indicatorcode))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>ginistack <span class="op">=</span> DataFramesMeta.<span class="fu">stack</span>(ginidat,<span class="fu">Not</span>([<span class="op">:</span>Country, <span class="op">:</span>countrycode,<span class="op">:</span>indicator,<span class="op">:</span>indicatorcode]))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rename!</span>(ginistack,<span class="fu">Dict</span>(<span class="st">"variable"</span> <span class="op">=&gt;</span> <span class="st">"Year"</span>, <span class="st">"value"</span> <span class="op">=&gt;</span> <span class="st">"ginicoef"</span>))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>ginistack.Year <span class="op">=</span> <span class="fu">tryparse</span>.(<span class="dt">Int64</span>,ginistack.Year)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>alldat2 <span class="op">=</span> <span class="fu">leftjoin</span>(alldat,ginistack; on <span class="op">=</span> [<span class="op">:</span>Iso3_code <span class="op">=&gt;</span> <span class="op">:</span>countrycode, <span class="op">:</span>Year], makeunique<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> <span class="pp">@subset</span>(alldat2,<span class="op">:</span>PopulationJan <span class="op">.&gt;</span> <span class="fl">1e6</span>) <span class="fu">scatter</span>(<span class="op">:</span>ginicoef, <span class="op">:</span>homicide <span class="op">./</span> <span class="op">:</span>PopulationJan <span class="op">.*</span> <span class="fl">100000.0</span>; title<span class="op">=</span><span class="st">"Homicide Rate vs Inequality"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    ylab<span class="op">=</span><span class="st">"Homicides/100k"</span>,xlab<span class="op">=</span><span class="st">"Gini Index 0-100"</span>,legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> <span class="pp">@subset</span>(alldat2,<span class="op">:</span>PopulationJan <span class="op">.&gt;</span> <span class="fl">1e6</span>) <span class="fu">scatter</span>(<span class="op">:</span>ginicoef, <span class="fu">log</span>.(<span class="op">:</span>homicide <span class="op">./</span> <span class="op">:</span>PopulationJan <span class="op">.*</span> <span class="fl">100000.0</span>); group<span class="op">=:</span>Iso3_code, title<span class="op">=</span><span class="st">"log(Homicide Rate) vs Gini (Inequality)"</span>,ylab<span class="op">=</span><span class="st">"log(Homicides/100k)"</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    xlab<span class="op">=</span><span class="st">"Gini Index 0-100"</span>,legend<span class="op">=</span><span class="cn">false</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-4-output-1.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-4-output-2.svg" class="img-fluid"></p>
</div>
</div>
<p>Seeing the above graphs makes it clear that countries experiencing low levels of inequality, with Gini in the range 20-35 also tend to experience low homicide rates. These are most of the countries usually used in comparisons discussing gun control. European nations such as Austria, Czech Republic, Germany, France, Switzerland are all in this low end, and countries experiencing higher levels of inequality see exponential increases in violence. On this graph, exponential increases in violence correspond to a linear relationship between log(homicide rate) and Gini coefficient.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>gdp <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"data/API_NY.GDP.PCAP.CD_DS2_en_csv_v2_4251004.csv"</span>,DataFrame; header<span class="op">=</span><span class="fl">5</span>,skipto<span class="op">=</span><span class="fl">6</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rename!</span>(gdp,[<span class="fu">Symbol</span>(<span class="st">"Country Name"</span>) <span class="op">=&gt;</span> <span class="op">:</span>country, <span class="fu">Symbol</span>(<span class="st">"Country Code"</span>) <span class="op">=&gt;</span> <span class="op">:</span>ccode])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>gdp <span class="op">=</span> gdp[<span class="op">:</span>,<span class="fl">1</span><span class="op">:</span><span class="kw">end</span><span class="op">-</span><span class="fl">1</span>]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>gdpstack <span class="op">=</span> DataFramesMeta.<span class="fu">stack</span>(gdp,<span class="fu">Not</span>([<span class="st">"country"</span>,<span class="st">"ccode"</span>,<span class="st">"Indicator Name"</span>,<span class="st">"Indicator Code"</span>]))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rename!</span>(gdpstack,<span class="fu">Dict</span>(<span class="st">"variable"</span> <span class="op">=&gt;</span> <span class="st">"Year"</span>, <span class="st">"value"</span> <span class="op">=&gt;</span> <span class="st">"gdp2020dol"</span>))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>gdpstack.Year <span class="op">=</span> <span class="fu">tryparse</span>.(<span class="dt">Int64</span>,gdpstack.Year)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>alldat3 <span class="op">=</span> <span class="fu">leftjoin</span>(alldat2,gdpstack; on <span class="op">=</span> [<span class="op">:</span>Iso3_code <span class="op">=&gt;</span> <span class="op">:</span>ccode, <span class="op">:</span>Year],makeunique<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>alldat3.medianage <span class="op">=</span> <span class="fu">map</span>(x <span class="op">-&gt;</span> <span class="cf">if</span> <span class="fu">typeof</span>(x) <span class="op">!=</span> <span class="dt">Float64</span> <span class="cn">missing</span> <span class="cf">else</span> x <span class="cf">end</span>,alldat3.medianage)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>alldat3.popdensperkm2 <span class="op">=</span> <span class="fu">map</span>(x <span class="op">-&gt;</span> <span class="cf">if</span> <span class="fu">typeof</span>(x) <span class="op">!=</span> <span class="dt">Float64</span> <span class="cn">missing</span> <span class="cf">else</span> x <span class="cf">end</span>,alldat3.popdensperkm2)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>alldat3.loghom <span class="op">=</span> <span class="fu">log</span>.((alldat3.homicide <span class="op">.+</span> <span class="fl">0.1</span>) <span class="op">./</span> alldat3.PopulationJan <span class="op">.*</span> <span class="fl">100e3</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>alldat3.loggdppc <span class="op">=</span> <span class="fu">log</span>.(alldat3.gdp2020dol)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>alldat3.logpopdens <span class="op">=</span> <span class="fu">log</span>.(alldat3.popdensperkm2)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>alldat4 <span class="op">=</span> <span class="pp">@subset</span>(alldat3,.!<span class="fu">ismissing</span>.(alldat3.gdp2020dol) <span class="op">.&amp;&amp;</span> .! <span class="fu">ismissing</span>.(alldat3.ginicoef))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">#p = scatter(alldat4.ginicoef,alldat4.loghom; marker_z=alldat4.gdp2020dol ./ 75000.0, legend=false, seriescolor = cgrad([:lightgrey,:darkblue]), title="Log(Homicide rate) vs Gini\nActual (Color = GDP/capita)",ylim=(-4,4))</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#display(p)</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">scatter</span>(alldat4.ginicoef,alldat4.loghom;  color <span class="op">=</span> <span class="st">"black"</span>, title<span class="op">=</span><span class="st">"Log(Homicide rate) vs Gini"</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    ylim<span class="op">=</span>(<span class="op">-</span><span class="fl">2</span>,<span class="fl">5</span>),xlim<span class="op">=</span>(<span class="fl">25</span>,<span class="fl">60</span>),label<span class="op">=</span><span class="st">"worldwide"</span>,legend<span class="op">=</span><span class="cn">false</span>,alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> (<span class="st">"USA"</span>,<span class="st">"AUT"</span>,<span class="st">"AUS"</span>,<span class="st">"CHE"</span>,<span class="st">"ISR"</span>,<span class="st">"NLD"</span>,<span class="st">"NOR"</span>,<span class="st">"ESP"</span>,<span class="st">"DEU"</span>,<span class="st">"FRA"</span>,<span class="st">"CZE"</span>,<span class="st">"GRC"</span>,<span class="st">"BRA"</span>,<span class="st">"MEX"</span>,<span class="st">"ARG"</span>,<span class="st">"CAN"</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="fu">get</span>(colorschemes[<span class="op">:</span>rainbow],(i<span class="op">-</span><span class="fl">1</span>) <span class="op">/</span> <span class="fu">length</span>(countries)) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(countries)]</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>selectcountry <span class="op">=</span> <span class="pp">@subset</span>(alldat4,<span class="fu">in</span>.(alldat4.Iso3_code,<span class="fu">Ref</span>(countries)))</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">#@df selectcountry scatter!(:ginicoef,:loghom,markercolor=colors[indexin(:Iso3_code,collect(countries))])</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>countrydat <span class="op">=</span> <span class="pp">@by</span>(<span class="pp">@subset</span>(alldat4,<span class="fu">in</span>.(<span class="op">:</span>Iso3_code,<span class="fu">Ref</span>(countries)) <span class="op">.&amp;&amp;</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>ginicoef)),<span class="op">:</span>Iso3_code,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>ginimean <span class="op">=</span> <span class="fu">mean</span>(<span class="op">:</span>ginicoef),</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>loghommean <span class="op">=</span> <span class="fu">mean</span>(<span class="op">:</span>loghom))</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>annotations <span class="op">=</span> [(countrydat.ginimean[i],countrydat.loghommean[i],(countrydat.Iso3_code[i],<span class="fl">8</span> <span class="co">#,colors[i]</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    )) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span>(countrydat)]</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(annotations)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-5-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>In addition to Gini coefficient, which is a measure of variation in income, also the overall level of income is important. We can measure this by GDP/capita and this provides additional information that can be used to predict homicide rates.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> alldat3 <span class="fu">scatter</span>(<span class="op">:</span>loggdppc, <span class="op">:</span>loghom; title<span class="op">=</span><span class="st">"Log Homicide vs Log GDP/capita"</span>,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    xlab<span class="op">=</span><span class="st">"log(GDP/capita)"</span>,ylab<span class="op">=</span><span class="st">"log(homicide/100k/yr)"</span>, legend<span class="op">=</span><span class="cn">false</span>, alpha<span class="op">=</span><span class="fl">0.2</span>,smooth<span class="op">=</span><span class="cn">true</span>,linewidth<span class="op">=</span><span class="fl">5</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>gdpmod <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(loghom <span class="op">~</span> loggdppc <span class="op">+</span> loggdppc<span class="op">^</span><span class="fl">2</span>),alldat3)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(<span class="fu">collect</span>(<span class="fl">4</span><span class="op">:</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>),<span class="fu">predict</span>(gdpmod,<span class="fu">DataFrame</span>(loggdppc<span class="op">=</span><span class="fu">collect</span>(<span class="fl">4</span><span class="op">:</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>))))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(loghom  <span class="op">~</span> loggdppc <span class="op">+</span> ginicoef <span class="op">+</span> logpopdens  ),alldat3)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(mod)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">scatter</span>(alldat4.ginicoef,<span class="fu">predict</span>(mod,alldat4),alpha<span class="op">=</span><span class="fl">.1</span>, title<span class="op">=</span><span class="st">"Predicted Log(Homicide rate) vs Gini"</span>,ylim<span class="op">=</span>(<span class="op">-</span><span class="fl">2</span>,<span class="fl">5</span>),xlim<span class="op">=</span>(<span class="fl">25</span>,<span class="fl">60</span>),legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> alldat4 <span class="fu">scatter</span>(<span class="op">:</span>ginicoef, <span class="fu">residuals</span>(mod); title <span class="op">=</span> <span class="st">"Residual error in model vs Gini"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-6-output-1.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

loghom ~ 1 + loggdppc + ginicoef + logpopdens

Coefficients:
─────────────────────────────────────────────────────────────────────────────
                  Coef.  Std. Error       t  Pr(&gt;|t|)   Lower 95%   Upper 95%
─────────────────────────────────────────────────────────────────────────────
(Intercept)   1.42749    0.247308      5.77    &lt;1e-08   0.942318    1.91266
loggdppc     -0.305512   0.0176646   -17.30    &lt;1e-59  -0.340167   -0.270857
ginicoef      0.0823351  0.00281747   29.22    &lt;1e-99   0.0768077   0.0878624
logpopdens   -0.125143   0.0192312    -6.51    &lt;1e-09  -0.162871   -0.087415
─────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-6-output-3.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<p><img src="international_files/figure-html/cell-6-output-4.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="how-much-does-firearms-ownership-matter" class="level1">
<h1>How much does firearms ownership matter?</h1>
<p>It’s not exactly easy to estimate how many legally owned firearms are in every country in the world. Some places are regulated in such a way that registrations are a good indicator. For example perhaps Switzerland or Austria or Australia may be good examples. Other places such as Yemen has gun ownership as a guaranteed right in their constitution, but is in the process of fighting a Civil War which began in 2014 and continues even now. There is very little chance of a government having a clear idea of anything during a Civil War.</p>
<p>Nevertheless, the smallarmssurvey.org data has some sort of estimates of civilian firearms in various countries. Their dataset for 2019 is published on their website as a PDF printout of what appears to be an Excel spreadsheet. However, I have copied and pasted the text into a LibreOffice Calc spreadsheet then exported that as a csv file. The export does not immediately form a usable data file because of spaces in the names of countries and similar issues, however it can be read in and then reduced to a usable form. I extract the 3 letter country code, and the estimated number of guns, as well as the indicator for the methodology of the estimate. Using that data, we can ask whether guns per capita are related in any way to homicide results.</p>
</section>
<section id="trying-to-use-smallarmssurvey.org-data" class="level1">
<h1>Trying to use SmallArmsSurvey.org data</h1>
<p>I downloaded the PDF file of the Annex of civilian small arms data. this is a pdf output from most likely and Excel spreadsheet. By copying and pasting text from the PDF into a csv I got a not correctly formatted csv file,, as it uses spaces for delimiters in the copy and paste, and countries and regions contain spaces in their names…</p>
<p>The only way to use this data is to read line at a time, and keep the first column (ISO 3 code) and the second Number we encounter, as that’s the estimate of the firearms in civilian hands, as well as the 4th number which is encoding the estimation method. Once we extract this data, we then write it to a usable CSV file. we build this file if it doesn’t exist.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">Base</span>.Filesystem.<span class="fu">ispath</span>(<span class="st">"data/smallarms2020-clean.csv"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    gundata <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"data/smallarms2020-clean.csv"</span>,DataFrame)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    rws <span class="op">=</span> CSV.<span class="fu">Rows</span>(<span class="st">"data/smallarms2020.csv"</span>,header<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    gundata <span class="op">=</span> <span class="fu">DataFrame</span>(countrycode <span class="op">=</span> <span class="dt">String</span>[],civguns<span class="op">=</span> <span class="dt">Float64</span>[], esttype <span class="op">=</span> <span class="dt">Int64</span>[])</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> rws</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">#@show(r)</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">#@show(length(r))</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="fl">0</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        code <span class="op">=</span> r[<span class="fl">1</span>]</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        civguns <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        esttype <span class="op">=</span> <span class="fl">0</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> v <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu">length</span>(r)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            num <span class="op">=</span> <span class="cn">nothing</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> !<span class="fu">ismissing</span>(r[v])</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                num <span class="op">=</span> <span class="fu">tryparse</span>(<span class="dt">Float64</span>,r[v])</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> ! <span class="fu">isnothing</span>(num)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                n <span class="op">=</span> n<span class="op">+</span><span class="fl">1</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> n <span class="op">==</span> <span class="fl">2</span> </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                    civguns <span class="op">=</span> num</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elseif</span> n <span class="op">==</span> <span class="fl">4</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                    esttype <span class="op">=</span> <span class="fu">round</span>(<span class="dt">Int64</span>,num)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(gundata,(countrycode<span class="op">=</span>code,civguns<span class="op">=</span>civguns,esttype<span class="op">=</span>esttype))</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    CSV.<span class="fu">write</span>(<span class="st">"data/smallarms2020-clean.csv"</span>,gundata)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>alldat5 <span class="op">=</span> <span class="fu">leftjoin</span>(alldat4,gundata; on<span class="op">=:</span>Iso3_code <span class="op">=&gt;</span> <span class="op">:</span>countrycode)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>alldat5.civgpcap <span class="op">=</span> alldat5.civguns <span class="op">./</span> alldat5.PopulationJan</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>alldat5.logcivgpcap <span class="op">=</span> <span class="fu">log</span>.(alldat5.civgpcap)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>alldat5recent <span class="op">=</span> <span class="pp">@subset</span>(alldat5,<span class="fu">in</span>.(<span class="op">:</span>Year, <span class="fu">Ref</span>((<span class="fl">2017</span>,<span class="fl">2018</span>,<span class="fl">2019</span>))))</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> alldat5recent <span class="fu">scatter</span>(<span class="op">:</span>logcivgpcap, <span class="op">:</span>loghom,title<span class="op">=</span><span class="st">"Log(Hom rate) vs log(guns/capita)</span><span class="sc">\n</span><span class="st">2017-2019"</span>,legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co"># we only have an estimate of the guns/capita at a single time point, if we use multiple years, the changing "capita" </span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="co"># will create an artificial trend </span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>modlwguns2019 <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(loghom <span class="op">~</span> ginicoef <span class="op">+</span> loggdppc <span class="op">+</span> logcivgpcap),<span class="pp">@subset</span>(alldat5recent,<span class="op">:</span>Year <span class="op">.==</span> <span class="fl">2019</span>))</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(modlwguns2019)</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">scatter</span>(<span class="fu">residuals</span>(modlwguns2019),title<span class="op">=</span><span class="st">"Residual on model</span><span class="sc">\n</span><span class="st">(yr = 2019)"</span>,legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> <span class="pp">@subset</span>(alldat5,.! <span class="fu">ismissing</span>.(<span class="op">:</span>civgpcap) <span class="op">.&amp;&amp;</span> <span class="op">:</span>Year <span class="op">.==</span> <span class="fl">2019</span>) <span class="fu">histogram</span>(<span class="op">:</span>civgpcap; title<span class="op">=</span><span class="st">"Distribution of Guns/Capita</span><span class="sc">\n</span><span class="st">(2019)"</span>, bins<span class="op">=</span><span class="fl">40</span>,legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-7-output-1.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

loghom ~ 1 + ginicoef + loggdppc + logcivgpcap

Coefficients:
──────────────────────────────────────────────────────────────────────────
                 Coef.  Std. Error      t  Pr(&gt;|t|)   Lower 95%  Upper 95%
──────────────────────────────────────────────────────────────────────────
(Intercept)   1.70838     1.71872    0.99    0.3258  -1.75776     5.17451
ginicoef      0.103749    0.014436   7.19    &lt;1e-08   0.0746357   0.132861
loggdppc     -0.426233    0.130307  -3.27    0.0021  -0.689023   -0.163444
logcivgpcap   0.181102    0.142667   1.27    0.2111  -0.106614    0.468817
──────────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-7-output-3.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-7-output-4.svg" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getifnotthere</span>(<span class="st">"data/pums-2020-5yr-hus.zip"</span>,<span class="st">"https://www2.census.gov/programs-surveys/acs/data/pums/2020/5-Year/csv_hus.zip"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#getifnotthere("data/pums-2020-csv-hus.zip","https://www2.census.gov/programs-surveys/acs/experimental/2020/data/pums/1-Year/csv_hus.zip")</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#getifnotthere("data/PUMS_Data_Dictionary_2020.csv","https://www2.census.gov/programs-surveys/acs/experimental/2020/documentation/pums/PUMS_Data_Dictionary_2020.csv")</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">getifnotthere</span>(<span class="st">"data/PUMS_Data_Dectionary_2016-2020.pdf"</span>,<span class="st">"https://www2.census.gov/programs-surveys/acs/tech_docs/pums/data_dict/PUMS_Data_Dictionary_2016-2020.pdf"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> ! <span class="bu">Base</span>.Filesystem.<span class="fu">ispath</span>(<span class="st">"data/psam_husa.csv"</span>) <span class="op">||</span> ! <span class="bu">Base</span>.Filesystem.<span class="fu">ispath</span>(<span class="st">"data/psam_husb.csv"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cd</span>(<span class="st">"data"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">run</span>(<span class="ss">`unzip pums-2020-5yr-hus.zip`</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cd</span>(<span class="st">".."</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#pumsdd = CSV.read("data/PUMS_Data_Dictionary_2020.csv",DataFrame; header=false)</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#rename!(pumsdd,["IDFlag","varname","vartype","length","title_startval","endval","description"])</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>psamh <span class="op">=</span> <span class="kw">let</span> psamh <span class="op">=</span> <span class="fu">DataFrame</span>()</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> [<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>,<span class="st">"d"</span>]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"data/psam_hus</span><span class="sc">$</span>(i)<span class="st">.csv"</span>,DataFrame,select<span class="op">=</span>[<span class="op">:</span>SERIALNO,<span class="op">:</span>ST,<span class="op">:</span>FINCP,<span class="op">:</span>NP,<span class="op">:</span>WGTP])</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span>!(<span class="kw">new</span>,.!<span class="fu">ismissing</span>.(<span class="op">:</span>FINCP) <span class="op">.&amp;&amp;</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>NP))</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        psamh <span class="op">=</span> [psamh ; </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span>[<span class="fu">wsample</span>(<span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span>(<span class="kw">new</span>),<span class="kw">new</span>.WGTP,<span class="fu">round</span>(<span class="dt">Int64</span>,<span class="fl">0.1</span><span class="fu">*nrow</span>(<span class="kw">new</span>))),<span class="op">:</span>] ]</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    psamh</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>psamh.Year <span class="op">=</span> <span class="fu">tryparse</span>.(<span class="dt">Int64</span>,psamh.SERIALNO[i][<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span>(psamh))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">ginicoef</span>(incs,n)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="st">"Calculate the gini coefficient from a sample of incomes using sample of size n"</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    avg <span class="op">=</span> <span class="fu">mean</span>(incs)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    absdiff <span class="op">=</span> <span class="fu">abs</span>.(<span class="fu">sample</span>(incs,n) <span class="op">.-</span> <span class="fu">sample</span>(incs,n))</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(absdiff)<span class="op">/</span><span class="fl">2</span><span class="op">/</span>avg</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>fips <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"data/fipscodes.csv"</span>,DataFrame)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>psamh.pcapinc <span class="op">=</span> psamh.FINCP <span class="op">./</span> psamh.NP</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>stateginis <span class="op">=</span> <span class="pp">@by</span>(psamh,[<span class="op">:</span>Year,<span class="op">:</span>ST],<span class="op">:</span>gini <span class="op">=</span> <span class="fu">ginicoef</span>(<span class="op">:</span>pcapinc,<span class="fl">2000</span>),<span class="op">:</span>logmeaninc <span class="op">=</span> <span class="fu">log</span>(<span class="fu">mean</span>(<span class="op">:</span>pcapinc)))</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>stateginis <span class="op">=</span> <span class="fu">leftjoin</span>(stateginis,fips; on <span class="op">=</span> <span class="op">:</span>ST <span class="op">=&gt;</span> <span class="op">:</span>STATE)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>stateginis.gini100 <span class="op">=</span> stateginis.gini <span class="op">.*</span> <span class="fl">100.0</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co"># manually downloaded CDC wonder gun homicide data using online form </span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>gunhomicidesnew <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"./data/wonder-gun-homicide-byyear.csv"</span>,DataFrame)</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>gunhomicidesold <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"./data/cdc-wonder-firearm-homicide-1979-1998.csv"</span>,DataFrame)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>gunhomicides <span class="op">=</span> [gunhomicidesnew ; gunhomicidesold]</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>gunhomicides <span class="op">=</span> <span class="pp">@chain</span> <span class="fu">rename</span>(gunhomicides,<span class="fu">Dict</span>(<span class="st">"Crude Rate"</span> <span class="op">=&gt;</span> <span class="st">"crudedeathrate"</span>, <span class="st">"State Code"</span> <span class="op">=&gt;</span> <span class="st">"StateCode"</span>, <span class="st">"Year"</span> <span class="op">=&gt;</span> <span class="st">"year"</span>, <span class="st">"Year Code"</span> <span class="op">=&gt;</span> <span class="st">"YearCode"</span>)) <span class="cf">begin</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(.! <span class="fu">ismissing</span>.(<span class="op">:</span>Deaths))</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>(<span class="op">:</span>crudedeathrate <span class="op">=</span> <span class="fu">map</span>(x <span class="op">-&gt;</span> <span class="fu">isnothing</span>(x) ? <span class="cn">missing</span> <span class="op">:</span> x, <span class="fu">tryparse</span>.(<span class="dt">Float64</span>,<span class="fu">String</span>.(<span class="op">:</span>crudedeathrate))),</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>state <span class="op">=</span> <span class="fu">String31</span>.(<span class="op">:</span>State))</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(.! <span class="fu">ismissing</span>.(<span class="op">:</span>crudedeathrate))</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span>(<span class="op">:</span>StateCode,<span class="op">:</span>year)</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">plot</span>(<span class="pp">@by</span>(stateginis,<span class="op">:</span>ST,<span class="op">:</span>pl <span class="op">=</span> <span class="fu">plot</span>(<span class="op">:</span>Year,<span class="op">:</span>gini100,title<span class="op">=</span><span class="st">"</span><span class="sc">$</span>(<span class="op">:</span>STUSAB[<span class="fl">1</span>])<span class="st">"</span>,ylim<span class="op">=</span>(<span class="fl">30</span>,<span class="fl">60</span>))).pl<span class="op">...</span>)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>stateginis <span class="op">=</span> <span class="fu">leftjoin</span>(stateginis,gunhomicides; on <span class="op">=</span> [<span class="op">:</span>Year <span class="op">=&gt;</span> <span class="op">:</span>year, <span class="op">:</span>ST <span class="op">=&gt;</span> <span class="op">:</span>StateCode])</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> stateginis <span class="fu">scatter</span>(<span class="op">:</span>gini100,<span class="fu">log</span>.(<span class="op">:</span>crudedeathrate); title<span class="op">=</span><span class="st">"log(Firearm Homicide rate) vs Gini</span><span class="sc">\n</span><span class="st">US States 2016-2020"</span>, legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>stateginis.loghom <span class="op">=</span> <span class="fu">log</span>.(stateginis.crudedeathrate)</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(loghom <span class="op">~</span> gini100),stateginis)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(mod)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>Plots.<span class="fu">abline!</span>(<span class="fu">coef</span>(mod)[<span class="fl">2</span>],<span class="fu">coef</span>(mod)[<span class="fl">1</span>])</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>mod2 <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(loghom <span class="op">~</span> gini100 <span class="op">+</span> logmeaninc),stateginis)</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(mod2)</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> stateginis <span class="fu">scatter</span>(<span class="op">:</span>gini100,<span class="op">:</span>loghom; marker_z<span class="op">=:</span>logmeaninc,title<span class="op">=</span><span class="st">"Log(firearm homicide) vs Gini</span><span class="sc">\n</span><span class="st">Color = log(MeanIncome)"</span>)</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">scatter</span>(<span class="fu">residuals</span>(mod2); title <span class="op">=</span> <span class="st">"Residuals</span><span class="sc">\n</span><span class="st">loghom ~ 1 + gini100 + logmeanincome"</span>,markercolor<span class="op">=:</span>white,markerstrokecolor<span class="op">=:</span>white,legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">annotate!</span>(<span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span>(stateginis),<span class="fu">residuals</span>(mod2),stateginis.STUSAB,<span class="fu">font</span>(<span class="fl">8</span>))</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>suic <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"data/cdc-wonder-suicide-all-byyear.csv"</span>,DataFrame)</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="pp">@subset</span>!(suic,.! <span class="fu">ismissing</span>.(<span class="op">:</span>Year)) <span class="co"># drop summary/totals etc</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="fu">rename!</span>(suic,[<span class="op">:</span>Notes,<span class="op">:</span>State,<span class="op">:</span>StateCode,<span class="op">:</span>Year,<span class="op">:</span>YearCode,<span class="op">:</span>Deaths,<span class="op">:</span>Population,<span class="op">:</span>suicrate])</span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>stateginis <span class="op">=</span> <span class="fu">leftjoin</span>(stateginis,suic; on <span class="op">=</span> [<span class="op">:</span>Year,<span class="op">:</span>ST <span class="op">=&gt;</span> <span class="op">:</span>StateCode], makeunique<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> stateginis <span class="fu">scatter</span>(<span class="op">:</span>gini100,<span class="fu">log</span>.(<span class="op">:</span>suicrate); title <span class="op">=</span> <span class="st">"Log(Suicide Rate) vs Gini, in US"</span>,alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> stateginis <span class="fu">annotate!</span>(<span class="op">:</span>gini100,<span class="fu">log</span>.(<span class="op">:</span>suicrate),<span class="op">:</span>STUSAB,<span class="fu">font</span>(<span class="fl">8</span>))</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>stateginis.logsuic <span class="op">=</span> <span class="fu">log</span>.(stateginis.suicrate)</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>suicmod <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(logsuic <span class="op">~</span> gini100 <span class="op">+</span> logmeaninc),stateginis)</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(suicmod)</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> stateginis <span class="fu">scatter</span>(<span class="op">:</span>gini100,<span class="op">:</span>logmeaninc,title<span class="op">=</span><span class="st">"log(Mean income) vs gini"</span>,alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> stateginis <span class="fu">annotate!</span>(<span class="op">:</span>gini100,<span class="op">:</span>logmeaninc,<span class="op">:</span>STUSAB,title<span class="op">=</span><span class="st">"log(Mean income) vs gini"</span>,<span class="fu">font</span>(<span class="fl">8</span>))</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1055. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1055. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1056. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1056. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1057. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1058. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1059. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1060. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1061. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1062. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1063. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1064. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1065. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1066. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1067. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1068. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1069. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1070. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1071. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1072. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1073. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1074. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1075. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1076. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1077. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1078. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1079. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1080. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1081. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1082. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1083. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1084. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1085. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1086. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1087. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1088. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1089. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1090. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1091. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1092. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1093. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1094. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1095. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1096. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1097. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1098. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1099. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1100. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1101. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1102. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1103. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1104. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1105. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1106. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1107. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1108. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1109. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1110. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1111. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1112. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1113. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1114. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1115. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1116. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1117. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1118. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 3 warning: only found 1 / 8 columns around data row: 1119. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1034. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1034. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1035. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1035. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1036. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1037. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1038. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1039. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1040. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1041. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1042. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1043. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1044. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1045. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1046. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1047. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1048. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1049. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1050. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1051. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1052. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1053. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1054. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1055. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1056. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1057. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1058. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1059. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1060. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1061. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1062. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1063. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1064. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1065. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1066. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1067. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1068. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1069. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-8-output-5.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT
GKS: Rectangle definition is invalid in routine SET_VIEWPORT</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-8-output-7.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

loghom ~ 1 + gini100

Coefficients:
────────────────────────────────────────────────────────────────────────────
                  Coef.  Std. Error      t  Pr(&gt;|t|)   Lower 95%   Upper 95%
────────────────────────────────────────────────────────────────────────────
(Intercept)  -1.31007     0.64681    -2.03    0.0441  -2.58497    -0.035167
gini100       0.0605866   0.0141711   4.28    &lt;1e-04   0.0326545   0.0885186
────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

loghom ~ 1 + gini100 + logmeaninc

Coefficients:
────────────────────────────────────────────────────────────────────────────
                  Coef.  Std. Error      t  Pr(&gt;|t|)   Lower 95%   Upper 95%
────────────────────────────────────────────────────────────────────────────
(Intercept)   6.53681     2.4216      2.70    0.0075   1.76357    11.3101
gini100       0.0691587   0.0140779   4.91    &lt;1e-05   0.0414095   0.0969079
logmeaninc   -0.785135    0.233903   -3.36    0.0009  -1.24618    -0.324085
────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-8-output-10.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-8-output-11.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1223. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1223. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1224. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1224. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1225. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1226. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1227. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1228. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1229. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1230. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1231. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1232. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1233. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1234. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1235. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1236. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1237. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1238. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1239. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1240. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1241. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1242. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1243. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1244. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1245. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1246. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1247. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1248. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1249. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1250. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1251. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1252. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1253. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1254. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1255. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1256. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1257. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1258. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1259. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1260. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1261. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1262. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1263. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1264. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1265. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1266. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1267. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1268. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1269. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1270. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1271. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1272. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1273. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1274. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1275. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1276. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1277. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-8-output-14.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

logsuic ~ 1 + gini100 + logmeaninc

Coefficients:
─────────────────────────────────────────────────────────────────────────────
                  Coef.  Std. Error       t  Pr(&gt;|t|)   Lower 95%   Upper 95%
─────────────────────────────────────────────────────────────────────────────
(Intercept)  13.8275      0.975095    14.18    &lt;1e-33  11.9071     15.7479
gini100      -0.0220757   0.0051746   -4.27    &lt;1e-04  -0.0322667  -0.0118848
logmeaninc   -0.959548    0.0933208  -10.28    &lt;1e-20  -1.14334    -0.77576
─────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-8-output-16.svg" class="img-fluid"></p>
</div>
</div>
<p>Intriguingly looking at the state-by-state analysis in the US, we see a downward trend of suicides vs increasing Gini. This is rather interesting, and somewhat inexplicable. It may be that suicide in different age groups responds differently. For example if as people age their incomes increase and this is driver of inequality, and also increased income reduces suicide risk, then older people may reduce their suicide risk by being in a more unequal society. In more equal societies if it occurs because as people age they aren’t able to get ahead economically, then older people may be more prone to suicide in more equal societies, in part because they’re less well off.</p>
<p>These sorts of explanations may be relevant in the US where suicide risk increases with age, but other societies may have different issues. We can look across countries for comparisons.</p>
</section>
<section id="who-has-suicide-data" class="level1">
<h1>WHO has suicide data</h1>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Downloaded csv file from "https://www.who.int/data/gho/data/themes/mental-health/suicide-rates"</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getifnotthere</span>(<span class="st">"data/who-suicide-data.csv"</span>,<span class="st">"blob:null/25854b46-0aa5-4169-803f-54f897a51fb9"</span>) <span class="co">## this doesn't actually work obviously, but it's the link on the above page where I got the data</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>whosuic <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"data/who-suicide-data.csv"</span>,DataFrame)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>whosuicbs <span class="op">=</span> <span class="pp">@select</span>(<span class="pp">@subset</span>(whosuic,<span class="op">:</span>Dim1 <span class="op">.==</span> <span class="st">"Both sexes"</span>),<span class="op">:</span>countrycode <span class="op">=</span> <span class="op">:</span>SpatialDimValueCode,<span class="op">:</span>Year <span class="op">=</span> <span class="op">:</span><span class="dt">Period</span>,<span class="op">:</span>suicrate <span class="op">=</span> <span class="op">:</span>FactValueNumeric)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>suicginidat <span class="op">=</span> <span class="fu">leftjoin</span>(whosuicbs,ginistack; on <span class="op">=</span> [<span class="op">:</span>countrycode, <span class="op">:</span>Year],makeunique<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>suicginidat.logsuic <span class="op">=</span> <span class="fu">log</span>.(suicginidat.suicrate)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> suicginidat <span class="fu">scatter</span>(<span class="op">:</span>ginicoef,<span class="fu">log</span>.(<span class="op">:</span>suicrate); title <span class="op">=</span> <span class="st">"global log(Suicide) vs gini"</span>,legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>suimod <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(logsuic <span class="op">~</span> ginicoef),suicginidat)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(suimod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-9-output-1.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

logsuic ~ 1 + ginicoef

Coefficients:
─────────────────────────────────────────────────────────────────────────────
                  Coef.  Std. Error       t  Pr(&gt;|t|)   Lower 95%   Upper 95%
─────────────────────────────────────────────────────────────────────────────
(Intercept)   2.9503     0.0765375    38.55    &lt;1e-99   2.80016     3.10044
ginicoef     -0.0200779  0.00199524  -10.06    &lt;1e-22  -0.0239919  -0.0161639
─────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The graph shows that the pattern of declining suicide with increasing inequality repeats across the available country data from the WHO.</p>
<p>The existence of opposing trends implies that there should be an “optimum” amount of inequality. Inequality that reflects for example work experience related gains in income may be seen as “desirable” while inequality that comes about because of rent-seeking behavior, a rigged system that favors certain people, and similar effects would be generally seen as undesirable and stress inducing. Inequality that comes about because of large numbers of very poor people would drive particularly bad problems.</p>
<p>We can graph the log of the sum of suicide rate and homicide rate, and fit a parabola to see approximately where the optimal quantity of inequality would be.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>suihomcomb <span class="op">=</span> <span class="pp">@select</span>(<span class="fu">leftjoin</span>(alldat2,whosuicbs; on <span class="op">=</span> [<span class="op">:</span>Iso3_code <span class="op">=&gt;</span> <span class="op">:</span>countrycode,<span class="op">:</span>Year]),<span class="op">:</span>countrycode<span class="op">=:</span>Iso3_code,<span class="op">:</span>Year,<span class="op">:</span>homiciderate <span class="op">=</span> <span class="op">:</span>homicide <span class="op">./</span> <span class="op">:</span>PopulationJan <span class="op">.*</span> <span class="fl">100_000</span>,<span class="op">:</span>suicrate,<span class="op">:</span>ginicoef)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>suihomcomb.logshrate <span class="op">=</span> <span class="fu">log</span>.(suihomcomb.suicrate <span class="op">.+</span> suihomcomb.homiciderate)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> suihomcomb <span class="fu">scatter</span>(<span class="op">:</span>ginicoef,<span class="fu">log</span>.(<span class="op">:</span>homiciderate <span class="op">.+</span> <span class="op">:</span>suicrate); title <span class="op">=</span> <span class="st">"log(Suic+Hom) vs Gini"</span>,label<span class="op">=</span><span class="st">"log(Suicide + Homicide)"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>shmod2 <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(logshrate <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> ginicoef <span class="op">+</span> ginicoef<span class="op">^</span><span class="fl">2</span>),suihomcomb)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(<span class="fu">collect</span>(<span class="fl">20</span><span class="op">:</span><span class="fl">60</span>),<span class="fu">predict</span>(shmod2,<span class="fu">DataFrame</span>(ginicoef<span class="op">=</span><span class="fu">collect</span>(<span class="fl">20</span><span class="op">:</span><span class="fl">60</span>))); linewidth<span class="op">=</span><span class="fl">3</span>,label<span class="op">=</span><span class="st">"prediction"</span>,legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="international_files/figure-html/cell-10-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>It appears Gini coefficient in the range 30-35 is associated with least risk of violent harm and suicide put together.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>