<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>International Crime and Firearms Analysis – uscarry</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">International Crime and Firearms Analysis</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="dropdown-header">
 <span class="menu-text">about.qmd</span></li>
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#firearms-and-violent-crime-recent-trends" id="toc-firearms-and-violent-crime-recent-trends" class="nav-link active" data-scroll-target="#firearms-and-violent-crime-recent-trends">Firearms and Violent Crime, recent trends</a>
  <ul class="collapse">
  <li><a href="#so-what-do-we-know-about-firearms-carry-and-violence" id="toc-so-what-do-we-know-about-firearms-carry-and-violence" class="nav-link" data-scroll-target="#so-what-do-we-know-about-firearms-carry-and-violence">So what do we know about firearms carry and violence?</a></li>
  <li><a href="#lets-first-take-a-look-at-total-guns-vs-gun-homicides" id="toc-lets-first-take-a-look-at-total-guns-vs-gun-homicides" class="nav-link" data-scroll-target="#lets-first-take-a-look-at-total-guns-vs-gun-homicides">Let’s first take a look at total guns vs gun homicides</a></li>
  <li><a href="#firearms-data-as-a-time-series" id="toc-firearms-data-as-a-time-series" class="nav-link" data-scroll-target="#firearms-data-as-a-time-series">Firearms data as a time series</a></li>
  <li><a href="#a-zoom-in-to-regional-trends" id="toc-a-zoom-in-to-regional-trends" class="nav-link" data-scroll-target="#a-zoom-in-to-regional-trends">A zoom in to regional trends</a></li>
  </ul></li>
  <li><a href="#constitutional-carry" id="toc-constitutional-carry" class="nav-link" data-scroll-target="#constitutional-carry">Constitutional Carry</a></li>
  <li><a href="#states-by-geographic-group" id="toc-states-by-geographic-group" class="nav-link" data-scroll-target="#states-by-geographic-group">States by Geographic Group</a></li>
  <li><a href="#states-by-relative-change" id="toc-states-by-relative-change" class="nav-link" data-scroll-target="#states-by-relative-change">States by Relative Change</a></li>
  <li><a href="#what-has-been-the-relative-change" id="toc-what-has-been-the-relative-change" class="nav-link" data-scroll-target="#what-has-been-the-relative-change">What has been the relative change?</a></li>
  <li><a href="#modeling-the-process-with-bayesian-models" id="toc-modeling-the-process-with-bayesian-models" class="nav-link" data-scroll-target="#modeling-the-process-with-bayesian-models">Modeling the process with Bayesian Models</a></li>
  <li><a href="#shall-issue-vs-permitless" id="toc-shall-issue-vs-permitless" class="nav-link" data-scroll-target="#shall-issue-vs-permitless">Shall-issue vs permitless</a></li>
  <li><a href="#shall-issue-coefficients" id="toc-shall-issue-coefficients" class="nav-link" data-scroll-target="#shall-issue-coefficients">Shall Issue coefficients</a></li>
  <li><a href="#the-take-home" id="toc-the-take-home" class="nav-link" data-scroll-target="#the-take-home">The Take Home</a>
  <ul class="collapse">
  <li><a href="#permitlessconstitutional-carry-laws" id="toc-permitlessconstitutional-carry-laws" class="nav-link" data-scroll-target="#permitlessconstitutional-carry-laws">Permitless/Constitutional Carry laws</a></li>
  <li><a href="#shall-issue-laws" id="toc-shall-issue-laws" class="nav-link" data-scroll-target="#shall-issue-laws">Shall issue laws</a></li>
  <li><a href="#firearms-sales" id="toc-firearms-sales" class="nav-link" data-scroll-target="#firearms-sales">Firearms Sales</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">activate</span>(<span class="st">"."</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">CSV</span>, <span class="bu">StatsPlots</span>, <span class="bu">Downloads</span>, <span class="bu">DataFramesMeta</span>, <span class="bu">Dates</span>, <span class="bu">Statistics</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span>, <span class="bu">Memoization</span>, <span class="bu">ReverseDiff</span>, <span class="bu">Serialization</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span>, <span class="bu">Distributions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  Activating project at `~/Consulting/LakelandAppliedSciLLC/CriminologyGuns`</code></pre>
</div>
</div>
<section id="firearms-and-violent-crime-recent-trends" class="level1">
<h1>Firearms and Violent Crime, recent trends</h1>
<p>In late June 2022 the Supreme Court of the United States (SCOTUS) issued a ruling in <em>New York State Rifle and Pistol Association v Bruen</em> which ended the possibility for any state to issue concealed weapons (CCW) permits on the basis of judgement by government employees (known as “may issue” laws). For example in New York an applicant had to convince a police department that they had a “special need” for protection (such as for example a credible death threat) and in California the Sherriff of each county had a similar discretionary ability to decide whether there was a “sufficient cause” for issuing a permit. Simple self defense was not enough.</p>
<p>In the <em>Bruen</em> ruling, either permitless systems as now exist in 25 states, or CCW permit systems in which “objective” standards apply were the only allowable options (known as “shall issue” laws). Objective standards are for example “has never been convicted of a felony” or “has passed a required safety class” and other similar requirements which are factually verifiable by anyone.</p>
<p>After this ruling, as with most rulings liberalizing gun laws, political opponents of the ruling predicted “wild west” style shootouts in the streets. But in fact at the time of the ruling 43 states had either permitless carry (25 states) or a “shall issue” CCW permit system (18 states).</p>
<p>The usconcealedcarry.com website <a href="https://www.usconcealedcarry.com/resources/terminology/types-of-concealed-carry-licensurepermitting-policies/shall-issue/">shows</a> the following “shall issue” map. The only misleading data point is that Vermont is shown as red, because they have never regulated concealed carry in any way, it was explicitly constitutionally guaranteed from the beginning and so there is no CCW permit to issue at all.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/shall-issue-map.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Shall issue states</figcaption><p></p>
</figure>
</div>
<section id="so-what-do-we-know-about-firearms-carry-and-violence" class="level2">
<h2 class="anchored" data-anchor-id="so-what-do-we-know-about-firearms-carry-and-violence">So what do we know about firearms carry and violence?</h2>
<p>Let’s begin by loading several datasets. We have data on background checks each month, data matching FIPS codes for states, and CDC WONDER data on firearms homicides, as well as all homicides. We separate homicides from firearms suicides as they have a different cause and require different prevention techniques than violent crime. In general firearms suicides are about 2x as big as all homicides.</p>
<p>Loading and munging the data into useful form:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> !<span class="bu">Base</span>.Filesystem.<span class="fu">ispath</span>(<span class="st">"data/nics-firearm-background-checks.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Downloads</span>.<span class="fu">download</span>(<span class="st">"https://github.com/BuzzFeedNews/nics-firearm-background-checks/raw/master/data/nics-firearm-background-checks.csv"</span>,<span class="st">"./data/nics-firearm-background-checks.csv"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> !<span class="bu">Base</span>.Filesystem.<span class="fu">ispath</span>(<span class="st">"data/fipscodes.csv"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Downloads</span>.<span class="fu">download</span>(<span class="st">"https://www2.census.gov/geo/docs/reference/state.txt"</span>,<span class="st">"./data/fipscodes.csv"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>fipscodes <span class="op">=</span> <span class="pp">@chain</span> CSV.<span class="fu">read</span>(<span class="st">"data/fipscodes.csv"</span>,DataFrame) <span class="cf">begin</span>  </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(<span class="op">:</span>STATE <span class="op">.&lt;</span> <span class="fl">60</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># manually downloaded CDC wonder gun homicide data using online form </span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>gunhomicidesnew <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"./data/wonder-gun-homicide-byyear.csv"</span>,DataFrame)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>gunhomicidesold <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"./data/cdc-wonder-firearm-homicide-1979-1998.csv"</span>,DataFrame)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>gunhomicides <span class="op">=</span> [gunhomicidesnew ; gunhomicidesold]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>gunhomicides <span class="op">=</span> <span class="pp">@chain</span> <span class="fu">rename</span>(gunhomicides,<span class="fu">Dict</span>(<span class="st">"Crude Rate"</span> <span class="op">=&gt;</span> <span class="st">"crudedeathrate"</span>, <span class="st">"State Code"</span> <span class="op">=&gt;</span> <span class="st">"StateCode"</span>, <span class="st">"Year"</span> <span class="op">=&gt;</span> <span class="st">"year"</span>, <span class="st">"Year Code"</span> <span class="op">=&gt;</span> <span class="st">"YearCode"</span>)) <span class="cf">begin</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(.! <span class="fu">ismissing</span>.(<span class="op">:</span>Deaths))</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>(<span class="op">:</span>crudedeathrate <span class="op">=</span> <span class="fu">map</span>(x <span class="op">-&gt;</span> <span class="fu">isnothing</span>(x) ? <span class="cn">missing</span> <span class="op">:</span> x, <span class="fu">tryparse</span>.(<span class="dt">Float64</span>,<span class="fu">String</span>.(<span class="op">:</span>crudedeathrate))),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>state <span class="op">=</span> <span class="fu">String31</span>.(<span class="op">:</span>State))</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(.! <span class="fu">ismissing</span>.(<span class="op">:</span>crudedeathrate))</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span>(<span class="op">:</span>StateCode,<span class="op">:</span>year)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>gunchecks <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"./data/nics-firearm-background-checks.csv"</span>,DataFrame)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>startpops <span class="op">=</span> <span class="pp">@chain</span> gunhomicides, <span class="pp">@subset</span>(<span class="op">:</span>year <span class="op">.==</span> <span class="fl">1999</span>), <span class="pp">@select</span>(<span class="op">:</span>State, <span class="op">:</span>StartingPop <span class="op">=</span> <span class="op">:</span>Population,<span class="op">:</span>StartDeathRate <span class="op">=</span> <span class="op">:</span>crudedeathrate)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>gunsalesest <span class="op">=</span> <span class="pp">@chain</span> gunchecks,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span>(<span class="op">:</span>state,<span class="op">:</span>month),</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span>(<span class="op">:</span>state,<span class="op">:</span>month,<span class="op">:</span>salesest <span class="op">=</span> <span class="fl">1.1</span> <span class="op">.*</span> (<span class="op">:</span>handgun <span class="op">.+</span> <span class="op">:</span>long_gun) <span class="op">.+</span> <span class="fl">2.0</span> <span class="op">.*</span> <span class="op">:</span>multiple),</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">groupby</span>(<span class="op">:</span>state),</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>(<span class="op">:</span>cumsales <span class="op">=</span> <span class="fu">cumsum</span>(<span class="op">:</span>salesest),<span class="op">:</span>year<span class="op">=</span><span class="fu">year</span>.(<span class="op">:</span>month)),</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(<span class="fu">month</span>.(<span class="op">:</span>month) <span class="op">.==</span> <span class="fl">6</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> <span class="fu">leftjoin</span>(gunhomicides,gunsalesest, on<span class="op">=</span>[<span class="op">:</span>State <span class="op">=&gt;</span> <span class="op">:</span>state,<span class="op">:</span>year <span class="op">=&gt;</span> <span class="op">:</span>year]; matchmissing<span class="op">=:</span>notequal,makeunique<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> <span class="pp">@chain</span> <span class="fu">leftjoin</span>(joined,startpops; on<span class="op">=</span>[<span class="op">:</span>state <span class="op">=&gt;</span> <span class="op">:</span>State],makeunique<span class="op">=</span><span class="cn">true</span>) <span class="cf">begin</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(.! <span class="fu">ismissing</span>.(<span class="op">:</span>Deaths) <span class="op">.&amp;&amp;</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>StartingPop))</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(<span class="op">:</span>StateCode <span class="op">.&lt;</span> <span class="fl">60</span>)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>(<span class="op">:</span>cumgunrate <span class="op">=</span> (<span class="op">:</span>cumsales <span class="op">.+</span> <span class="fl">1.0</span> <span class="op">.*</span> <span class="op">:</span>StartingPop) <span class="op">./</span> <span class="op">:</span>Population )</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> <span class="pp">@orderby</span>(<span class="fu">leftjoin</span>(joined,fipscodes,on <span class="op">=</span> <span class="op">:</span>state <span class="op">=&gt;</span> <span class="op">:</span>STATE_NAME),<span class="op">:</span>StateCode,<span class="op">:</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1055. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1055. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1056. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1056. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1057. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1058. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1059. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1060. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1061. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1062. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1063. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1064. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1065. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1066. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1067. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1068. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1069. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1070. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1071. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1072. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1073. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1074. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1075. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1076. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1077. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1078. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1079. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1080. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1081. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1082. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1083. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1084. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1085. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1086. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1087. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1088. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1089. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1090. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1091. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1092. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1093. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1094. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1095. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1096. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1097. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1098. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1099. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1100. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1101. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1102. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1103. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1104. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1105. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1106. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1107. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1108. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1109. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1110. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1111. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1112. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1113. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1114. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1115. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1116. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1117. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1118. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 4 warning: only found 1 / 8 columns around data row: 1119. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1034. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1034. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1035. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1035. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1036. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1037. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1038. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1039. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1040. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1041. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1042. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1043. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1044. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1045. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1046. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1047. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1048. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1049. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1050. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1051. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1052. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1053. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1054. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1055. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1056. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1057. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1058. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1059. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1060. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1061. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1062. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1063. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1064. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1065. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1066. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1067. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1068. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578
┌ Warning: thread = 5 warning: only found 1 / 8 columns around data row: 1069. Filling remaining columns with `missing`
└ @ CSV /var/local/dlakelan/dotjulia/packages/CSV/jFiCn/src/file.jl:578</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div class="data-frame"><p>1,677 rows × 18 columns (omitted printing of 10 columns)</p><table class="data-frame table table-sm table-striped"><thead><tr><th></th><th>Notes</th><th>State</th><th>StateCode</th><th>year</th><th>YearCode</th><th>Deaths</th><th>Population</th><th>crudedeathrate</th></tr><tr><th></th><th title="Union{Missing, String}">String?</th><th title="Union{Missing, String31}">String31?</th><th title="Union{Missing, Int64}">Int64?</th><th title="Union{Missing, Int64}">Int64?</th><th title="Union{Missing, Int64}">Int64?</th><th title="Union{Missing, Int64}">Int64?</th><th title="Union{Missing, Int64}">Int64?</th><th title="Union{Missing, Float64}">Float64?</th></tr></thead><tbody><tr><th>1</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1979</td><td>1979</td><td>376</td><td>3873403</td><td>9.707</td></tr><tr><th>2</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1980</td><td>1980</td><td>457</td><td>3898117</td><td>11.724</td></tr><tr><th>3</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1981</td><td>1981</td><td>384</td><td>3920097</td><td>9.796</td></tr><tr><th>4</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1982</td><td>1982</td><td>360</td><td>3925924</td><td>9.17</td></tr><tr><th>5</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1983</td><td>1983</td><td>268</td><td>3933838</td><td>6.813</td></tr><tr><th>6</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1984</td><td>1984</td><td>290</td><td>3952400</td><td>7.337</td></tr><tr><th>7</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1985</td><td>1985</td><td>299</td><td>3974101</td><td>7.524</td></tr><tr><th>8</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1986</td><td>1986</td><td>320</td><td>3993162</td><td>8.014</td></tr><tr><th>9</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1987</td><td>1987</td><td>306</td><td>4017181</td><td>7.617</td></tr><tr><th>10</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1988</td><td>1988</td><td>340</td><td>4027045</td><td>8.443</td></tr><tr><th>11</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1989</td><td>1989</td><td>342</td><td>4034980</td><td>8.476</td></tr><tr><th>12</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1990</td><td>1990</td><td>381</td><td>4043643</td><td>9.422</td></tr><tr><th>13</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1991</td><td>1991</td><td>423</td><td>4101607</td><td>10.313</td></tr><tr><th>14</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1992</td><td>1992</td><td>387</td><td>4155699</td><td>9.313</td></tr><tr><th>15</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1993</td><td>1993</td><td>412</td><td>4216208</td><td>9.772</td></tr><tr><th>16</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1994</td><td>1994</td><td>432</td><td>4262457</td><td>10.135</td></tr><tr><th>17</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1995</td><td>1995</td><td>400</td><td>4298981</td><td>9.305</td></tr><tr><th>18</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1996</td><td>1996</td><td>382</td><td>4334219</td><td>8.814</td></tr><tr><th>19</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1997</td><td>1997</td><td>371</td><td>4370490</td><td>8.489</td></tr><tr><th>20</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1998</td><td>1998</td><td>326</td><td>4408398</td><td>7.395</td></tr><tr><th>21</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>1999</td><td>1999</td><td>293</td><td>4430141</td><td>6.6</td></tr><tr><th>22</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>2000</td><td>2000</td><td>294</td><td>4447100</td><td>6.6</td></tr><tr><th>23</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>2001</td><td>2001</td><td>302</td><td>4467634</td><td>6.8</td></tr><tr><th>24</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>2002</td><td>2002</td><td>292</td><td>4480089</td><td>6.5</td></tr><tr><th>25</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>2003</td><td>2003</td><td>322</td><td>4503491</td><td>7.2</td></tr><tr><th>26</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>2004</td><td>2004</td><td>262</td><td>4530729</td><td>5.8</td></tr><tr><th>27</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>2005</td><td>2005</td><td>319</td><td>4569805</td><td>7.0</td></tr><tr><th>28</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>2006</td><td>2006</td><td>333</td><td>4628981</td><td>7.2</td></tr><tr><th>29</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>2007</td><td>2007</td><td>378</td><td>4672840</td><td>8.1</td></tr><tr><th>30</th><td><em>missing</em></td><td>Alabama</td><td>1</td><td>2008</td><td>2008</td><td>349</td><td>4718206</td><td>7.4</td></tr><tr><th>⋮</th><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td></tr></tbody></table></div>
</div>
</div>
</section>
<section id="lets-first-take-a-look-at-total-guns-vs-gun-homicides" class="level2">
<h2 class="anchored" data-anchor-id="lets-first-take-a-look-at-total-guns-vs-gun-homicides">Let’s first take a look at total guns vs gun homicides</h2>
<p>Although we don’t have a proper starting value for the beginning of the period, we know that for quite a while now the number of guns per capita in the US is on the order of 1. We therefore put a starting value of 1 for <strong>every state</strong> even though in fact this should vary somewhat likely between 0.7 and 1.5 or so, and then cumulatively total up the approximate number of firearms purchased since then and divide by the running population estimate, to calculate a firearms per capita time series.</p>
<p>We then plot firearms homicides vs firearms per capita as a parametric curve with time not visible. If purchasing guns causes gun homicides, then as guns per capita increases through time so will firearms homicides. However there are also <strong>other</strong> models that could cause such trends.</p>
<p>Nevertheless, if gun purchases do cause gun homicides, we should see these positive trending lines.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(<span class="fu">plot</span>(joined.cumgunrate,joined.crudedeathrate; group<span class="op">=</span>joined.state, legend<span class="op">=</span><span class="cn">false</span>, xlab<span class="op">=</span><span class="st">"Gun Rate (guns/capita)"</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    ylab<span class="op">=</span><span class="st">"Firearm Homicide Rate (deaths/100kcapita/yr)"</span>, title<span class="op">=</span><span class="st">"Gun Homicide vs Gun Prevalence"</span>, alpha<span class="op">=</span><span class="fl">.5</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(<span class="fu">plot</span>(joined.cumgunrate,joined.crudedeathrate; group<span class="op">=</span>joined.state, legend<span class="op">=</span><span class="cn">false</span>, xlab<span class="op">=</span><span class="st">"Gun Rate (guns/capita)"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    ylab<span class="op">=</span><span class="st">"Firearm Homicide Rate (deaths/100kcapita/yr)"</span>, title<span class="op">=</span><span class="st">"Gun Homicide vs Gun Prevalence"</span>, alpha<span class="op">=</span><span class="fl">.5</span>, ylim<span class="op">=</span>(<span class="fl">0</span>,<span class="fl">12</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-4-output-1.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-4-output-2.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="firearms-data-as-a-time-series" class="level2">
<h2 class="anchored" data-anchor-id="firearms-data-as-a-time-series">Firearms data as a time series</h2>
<p>In addition we plot how Homicides have changed through time, and how firearms per capita has changed through time</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(<span class="fu">plot</span>(joined.year,joined.crudedeathrate; group<span class="op">=</span>joined.state, legend<span class="op">=</span><span class="cn">false</span>, xlab<span class="op">=</span><span class="st">"Year"</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    ylab<span class="op">=</span><span class="st">"Firearm Homicide Rate (deaths/100kcapita/yr)"</span>, title<span class="op">=</span><span class="st">"Gun Homicide vs Time"</span>, alpha<span class="op">=</span><span class="fl">.5</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(<span class="fu">plot</span>(joined.year, joined.cumgunrate; group<span class="op">=</span>joined.state, legend<span class="op">=</span><span class="cn">false</span>, xlab<span class="op">=</span><span class="st">"Year"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    ylab<span class="op">=</span><span class="st">"Firearms Per Capita Estimate (guns/person)"</span>, title<span class="op">=</span><span class="st">"Gun Ownership vs Time"</span>, alpha<span class="op">=</span><span class="fl">.5</span>, ylim<span class="op">=</span>(<span class="fl">0</span>,<span class="fl">4</span>),xlim<span class="op">=</span>(<span class="fl">1999</span>,<span class="fl">2020</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-5-output-1.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-5-output-2.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="a-zoom-in-to-regional-trends" class="level2">
<h2 class="anchored" data-anchor-id="a-zoom-in-to-regional-trends">A zoom in to regional trends</h2>
</section>
</section>
<section id="constitutional-carry" class="level1">
<h1>Constitutional Carry</h1>
<p>The most recent trend in firearms carry in the US is the conversion of “shall issue” states to a permitless carry system. In this system everyone over a certain age (18 or 21 depending on state) who is legally able to possess a pistol may carry that pistol concealed in public subject to relatively few restrictions (such as not allowed in secure areas with metal detectors etc). For the moment we ignore the issue of “open carry” which has different issues such as intimidation purposes.</p>
<p>Of all the systems for regulating firearms in public, this is the least restrictive. There are various models one might have of how this would affect gun homicides. Some might argue armed citizens deter crime, others might argue it makes it easier to commit crime, others might argue the effect if any would be minimal as criminals were already carrying guns and only relatively “model citizens” would start carrying, and they are generally not involved in crime in terms of committing them or as victims. It’s worthwhile to look at the data to see what hypotheses are comopatible with the observed trends.</p>
<p>We plot firearms homicide rates through time for each state. We place a vertical red line at the point in time where the constitutional carry law was signed if any.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>concarry <span class="op">=</span> <span class="fu">leftjoin</span>(fipscodes,CSV.<span class="fu">read</span>(<span class="st">"./data/ConstCarryDates.csv"</span>,DataFrame),on <span class="op">=</span> <span class="op">:</span>STUSAB <span class="op">=&gt;</span> <span class="op">:</span>StateCode)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>concarry.date <span class="op">=</span> <span class="fu">map</span>(x <span class="op">-&gt;</span> <span class="fu">ismissing</span>(x) ? <span class="cn">missing</span> <span class="op">:</span> <span class="fu">Date</span>(<span class="fu">div</span>(x,<span class="fl">10000</span>),<span class="fu">div</span>(<span class="fu">mod</span>(x,<span class="fl">10000</span>),<span class="fl">100</span>),<span class="fl">1</span>),concarry.LawDate)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>concarry.year <span class="op">=</span> <span class="fu">map</span>(x <span class="op">-&gt;</span> <span class="fu">ismissing</span>(x) ? <span class="cn">missing</span> <span class="op">:</span> <span class="fu">year</span>(x),concarry.date)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>concarry <span class="op">=</span> <span class="pp">@subset</span>(concarry,<span class="op">:</span>STATE <span class="op">.&lt;=</span> <span class="fl">59</span>) <span class="co">#ignore minor territories</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> p <span class="op">=</span> []</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (st,stusab,statename,statens,lawdate,stdate,year) <span class="kw">in</span> <span class="fu">eachrow</span>(concarry)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> year</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> <span class="pp">@subset</span>(joined,<span class="op">:</span>state <span class="op">.==</span> statename)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">nrow</span>(sub) <span class="op">&gt;</span> <span class="fl">0</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>            pp <span class="op">=</span> <span class="fu">plot</span>(sub.year,sub.crudedeathrate,ylim<span class="op">=</span>(<span class="fl">0</span>,<span class="fl">15</span>),size<span class="op">=</span>(<span class="fl">500</span>,<span class="fl">500</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                title<span class="op">=</span><span class="st">"</span><span class="sc">$</span>statename<span class="sc">\n</span><span class="st">homicides"</span>,xlab<span class="op">=</span><span class="st">"Year"</span>,ylab<span class="op">=</span><span class="st">"Gun Homicide/100k/yr"</span>,legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(!<span class="fu">ismissing</span>(d))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                pp <span class="op">=</span> <span class="fu">plot!</span>([(d,<span class="fl">0</span>),(d,<span class="fl">15</span>)])</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(p,pp)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(<span class="fu">plot</span>(p<span class="op">...</span>; size <span class="op">=</span> (<span class="fl">2000</span>,<span class="fl">2000</span>)))</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-6-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="states-by-geographic-group" class="level1">
<h1>States by Geographic Group</h1>
<p>Looking at the raw data we can see that there are a number of states that have an “accelerating” trend of increased firearms homicide violence in the period from about mid 2014 to 2015 onward. Some of these have converted to Constitutional Carry near the beginning of that period or during that period, with the trend beginning before the carry provision for several of the states. Also many states have passed their laws in the last few years and have no data post-law.</p>
<p>Let’s look at these states grouped into geographic regions, because trends in regions may be more obvious. We will start with the following groupings:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>stategroups <span class="op">=</span> [[<span class="st">"WA"</span>,<span class="st">"OR"</span>,<span class="st">"CA"</span>,<span class="st">"NV"</span>,<span class="st">"AZ"</span>],[<span class="st">"ID"</span>,<span class="st">"MT"</span>,<span class="st">"WY"</span>,<span class="st">"UT"</span>,<span class="st">"CO"</span>,<span class="st">"NM"</span>,<span class="st">"TX"</span>],[<span class="st">"ND"</span>,<span class="st">"SD"</span>,<span class="st">"NE"</span>,<span class="st">"KS"</span>,<span class="st">"OK"</span>,<span class="st">"IA"</span>,<span class="st">"MO"</span>],</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"MN"</span>,<span class="st">"WI"</span>,<span class="st">"IL"</span>,<span class="st">"IN"</span>,<span class="st">"MI"</span>,<span class="st">"OH"</span>],[<span class="st">"AR"</span>,<span class="st">"LA"</span>,<span class="st">"MS"</span>,<span class="st">"AL"</span>,<span class="st">"GA"</span>,<span class="st">"FL"</span>,<span class="st">"SC"</span>],[<span class="st">"TN"</span>,<span class="st">"NC"</span>,<span class="st">"KY"</span>,<span class="st">"WV"</span>,<span class="st">"VA"</span>,<span class="st">"MD"</span>,<span class="st">"DE"</span>],</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"PA"</span>,<span class="st">"NJ"</span>,<span class="st">"NY"</span>,<span class="st">"CT"</span>,<span class="st">"RI"</span>,<span class="st">"MA"</span>,<span class="st">"VT"</span>,<span class="st">"NH"</span>,<span class="st">"ME"</span>],[<span class="st">"AK"</span>,<span class="st">"HI"</span>,<span class="st">"DC"</span>]]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>stategroupdf <span class="op">=</span> <span class="fu">DataFrame</span>(STUSAB <span class="op">=</span> <span class="fu">reduce</span>(vcat,stategroups),stgroup <span class="op">=</span> <span class="fu">reduce</span>(vcat,[[k for j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(stategroups[k])] for k <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(stategroups)]))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>stategroupdf <span class="op">=</span> <span class="fu">leftjoin</span>(fipscodes,stategroupdf; on <span class="op">=</span> <span class="op">:</span>STUSAB)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="pp">@assert</span>(<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">reduce</span>(vcat,stategroups))) <span class="op">==</span> <span class="fl">51</span>) <span class="co"># 50 states plus DC</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> p1 <span class="op">=</span> [], p2<span class="op">=</span>[]</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> statelist <span class="kw">in</span> stategroups</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> joined[<span class="fu">in</span>.(joined.STUSAB, <span class="fu">Ref</span>(statelist)),<span class="op">:</span>]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        ccdates <span class="op">=</span> <span class="pp">@chain</span> <span class="pp">@subset</span>(concarry, <span class="fu">in</span>.(concarry.STUSAB,<span class="fu">Ref</span>(statelist))) <span class="cf">begin</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@subset</span>(.! <span class="fu">ismissing</span>.(<span class="op">:</span>year))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        ccdatesenact <span class="op">=</span> <span class="fu">leftjoin</span>(ccdates,sub, on <span class="op">=</span> [<span class="op">:</span>STUSAB <span class="op">=&gt;</span> <span class="op">:</span>STUSAB, <span class="op">:</span>year <span class="op">=&gt;</span> <span class="op">:</span>year], makeunique <span class="op">=</span> <span class="cn">true</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        ccdatesenact <span class="op">=</span> <span class="pp">@subset</span>(ccdatesenact, .! <span class="fu">ismissing</span>.(<span class="op">:</span>crudedeathrate))</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">#display(ccdatesenact)</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">#display(sub)</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="fu">plot</span>(sub.year,sub.crudedeathrate,group<span class="op">=</span>sub.STUSAB,ylim<span class="op">=</span>(<span class="fl">0</span>,<span class="fl">20</span>),legend<span class="op">=:</span>topleft,linewidth <span class="op">=</span> <span class="fl">3</span>, thickness_scaling<span class="op">=</span><span class="fl">1</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            ylab<span class="op">=</span><span class="st">"Homicides/100k population/yr"</span>,xlab<span class="op">=</span><span class="st">"Year"</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">nrow</span>(ccdatesenact) <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> <span class="fu">scatter!</span>(ccdatesenact.year,ccdatesenact.crudedeathrate,markersize<span class="op">=</span><span class="fl">6</span>,group <span class="op">=</span> ccdatesenact.STUSAB)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(p1,p)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="fu">plot</span>(sub.cumgunrate,sub.crudedeathrate,markersize<span class="op">=</span><span class="fl">6</span>,linewidth<span class="op">=</span><span class="fl">3</span>,thickness_scaling<span class="op">=</span><span class="fl">1</span>, xlab<span class="op">=</span><span class="st">"Gun Ownership (guns/person)"</span>, ylab<span class="op">=</span><span class="st">"Homicide rate (per 100k)"</span>, group<span class="op">=</span>sub.STUSAB)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(p2,p)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(<span class="fu">plot</span>(p1<span class="op">...</span>; size<span class="op">=</span>(<span class="fl">1000</span>,<span class="fl">1000</span>)))</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(<span class="fu">plot</span>(p2<span class="op">...</span>; size<span class="op">=</span>(<span class="fl">1000</span>,<span class="fl">1000</span>)))</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-7-output-1.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-7-output-2.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="states-by-relative-change" class="level1">
<h1>States by Relative Change</h1>
<p>Each state has its own overall level of firearm violence, but often trends in the same direction relative to its region even if its overall level is higher or lower. This suggests a model in which we measure each state using a dimensionless number relative to some baseline level. For example the average rate in the years 1999,2000,2001</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>baselines <span class="op">=</span> <span class="pp">@chain</span> joined <span class="cf">begin</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(<span class="fu">in</span>.(<span class="op">:</span>year,<span class="fu">Ref</span>((<span class="fl">1999</span>,<span class="fl">2000</span>,<span class="fl">2001</span>))))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@by</span>(<span class="op">:</span>STUSAB, <span class="op">:</span>baseline <span class="op">=</span> <span class="fu">mean</span>(<span class="op">:</span>crudedeathrate))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>bljoined <span class="op">=</span> <span class="pp">@chain</span> <span class="fu">leftjoin</span>(stategroupdf,<span class="fu">leftjoin</span>(baselines,joined,on <span class="op">=</span> <span class="op">:</span>STUSAB, makeunique<span class="op">=</span><span class="cn">true</span>),on<span class="op">=:</span>STUSAB,makeunique<span class="op">=</span><span class="cn">true</span>) <span class="cf">begin</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(.! <span class="fu">ismissing</span>.(<span class="op">:</span>crudedeathrate))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span>(<span class="op">:</span>stgroup,<span class="op">:</span>STUSAB,<span class="op">:</span>year)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getccd</span>(gr)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    ccd <span class="op">=</span> <span class="fu">innerjoin</span>(gr,<span class="pp">@subset</span>(concarry,.! <span class="fu">ismissing</span>.(<span class="op">:</span>year)), on <span class="op">=</span> [<span class="op">:</span>STUSAB <span class="op">=&gt;</span> <span class="op">:</span>STUSAB, <span class="op">:</span>year <span class="op">=&gt;</span> <span class="op">:</span>year], makeunique <span class="op">=</span> <span class="cn">true</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    ccd <span class="op">=</span> <span class="pp">@subset</span>(ccd, .! <span class="fu">ismissing</span>.(<span class="op">:</span>crudedeathrate))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ccd</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">makerelplot</span>(gr)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    ccd <span class="op">=</span> <span class="fu">getccd</span>(gr)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co">#    display(ccd)</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">plot</span>(gr.year,gr.crudedeathrate <span class="op">./</span> gr.baseline,group<span class="op">=</span>gr.STUSAB,legend<span class="op">=:</span>topleft,ylim<span class="op">=</span>(<span class="fl">0.0</span>,<span class="fl">2.5</span>),xlab<span class="op">=</span><span class="st">"Year"</span>,ylab<span class="op">=</span><span class="st">"Relative Rate"</span>) </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">nrow</span>(ccd) <span class="op">==</span> <span class="fl">1</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scatter!</span>(ccd.year,ccd.crudedeathrate <span class="op">./</span> ccd.baseline)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elseif</span> <span class="fu">nrow</span>(ccd) <span class="op">&gt;</span> <span class="fl">1</span> </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scatter!</span>(ccd.year,ccd.crudedeathrate <span class="op">./</span> ccd.baseline,group <span class="op">=</span> ccd.STUSAB)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    p</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>makerelplot (generic function with 1 method)</code></pre>
</div>
</div>
</section>
<section id="what-has-been-the-relative-change" class="level1">
<h1>What has been the relative change?</h1>
<p>Each state plotted in a group with other geographically similar states. Firearm homicide rate relative to average recorded rate 1999-2001.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plots <span class="op">=</span> [<span class="fu">makerelplot</span>(gr)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    for gr <span class="kw">in</span> <span class="fu">groupby</span>(bljoined,<span class="op">:</span>stgroup)]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plots<span class="op">...</span> ; size<span class="op">=</span>(<span class="fl">1000</span>,<span class="fl">1000</span>),linewidth<span class="op">=</span><span class="fl">2</span>,xlab<span class="op">=</span><span class="st">"Year"</span>,ylab<span class="op">=</span><span class="st">"Relative Rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<p><img src="USCarry_files/figure-html/cell-9-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="modeling-the-process-with-bayesian-models" class="level1">
<h1>Modeling the process with Bayesian Models</h1>
<p>We can try to estimate the effects of these laws by building a model of the overall process. Because we can’t resurrect people from the dead, the homicide rate can never be negative. It makes sense then to model the homicide rate on a logarithmic scale.</p>
<p>We estimate the behavior of the states as an overall level, plus a shape that is common to the region. Individual states are then allowed a small perturbation to the regional shape.</p>
<p>This small perturbation method was the only way that seemed to make sense to estimate the counterfactual. Clearly none of the states will perform exactly like the average. So if we use the regional average, we will bias towards a lot of noise. Obviously, there is no effect if no law was passed, so for those states with no law passed, the counterfactual is the same as the actual, and we then should allow a size of perturbation which allows the function to fit the actuals for those states. By modifying the parameter <code>statecoefpert</code> we can make it as small as possible while still causing all the non-law states to fit reasonably well. At this point whatever lack of fit there is post-law in those states, could be at least partially attributed to the law. The choice of value of <code>log(1.25)/2.0 ~ 0.112</code> seemed to fit the bill, leaving only Maryland the only non-law not quite well fit by the model. Any smaller value left both MD and NY fitting poorly.</p>
<p>The effect of constitutional carry law would then be estimated as the log firearm homicide rate which <strong>exceeds the state level counterfactual estimate</strong> in the years after the passage of the law, with a transient onset curve included in the model.</p>
<p>We impose an informal smoothness requirement on the counterfactual estimates by using a compact radial basis function expansion with one center every 4 years, and a maximum radius of 7 years so that there is overlap between adjacent centers.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">bumpfun</span>(x,c,scale)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    stdx <span class="op">=</span> (x<span class="op">-</span>c)<span class="op">/</span>scale</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> stdx <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1.0</span> <span class="op">||</span> stdx <span class="op">&gt;</span> <span class="fl">1.0</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.0</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">exp</span>(<span class="fl">1.0</span><span class="op">-</span><span class="fl">1.0</span><span class="op">/</span>(<span class="fl">1.0</span><span class="op">-</span>stdx<span class="op">^</span><span class="fl">2</span>)) <span class="co"># goes to zero at -1 and 1, and 1 at x=0</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">timeser</span>(x,coefs,centers,scale)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (a,c) <span class="kw">in</span> <span class="bu">Iterators</span>.<span class="fu">zip</span>(coefs,centers)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        f <span class="op">+=</span> <span class="fu">a*bumpfun</span>(x,c,scale)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> f</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">laweffect</span>(yr,rate,start)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> yr <span class="op">&gt;=</span> start</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.0</span><span class="fu">-exp</span>(<span class="fu">-rate*</span>(yr<span class="op">-</span>start))</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>   </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.0</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>statecoefpert <span class="op">=</span> <span class="fu">log</span>(<span class="fl">1.25</span>)<span class="op">/</span><span class="fl">2.0</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="fu">include</span>(<span class="st">"model.jl"</span>) <span class="co">## load the model, this is a separate file so we can save the output unless it changes</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>modeljoined <span class="op">=</span> <span class="pp">@chain</span> <span class="fu">leftjoin</span>(joined,stategroupdf; on <span class="op">=</span> <span class="op">:</span>STUSAB, makeunique<span class="op">=</span><span class="cn">true</span>) <span class="cf">begin</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(.! <span class="fu">ismissing</span>.(<span class="op">:</span>crudedeathrate))</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>lawdates <span class="op">=</span> <span class="pp">@chain</span> <span class="fu">leftjoin</span>(<span class="fu">DataFrame</span>(STATE<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">55</span>),concarry; on<span class="op">=:</span>STATE) <span class="cf">begin</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(<span class="op">:</span>STATE <span class="op">.&lt;</span> <span class="fl">60</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rtransform</span>(<span class="op">:</span>year <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>year) ? <span class="fl">3000</span> <span class="op">:</span> <span class="op">:</span>year)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span>(<span class="op">:</span>STATE)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>centers <span class="op">=</span> [i for i <span class="kw">in</span> (<span class="fu">minimum</span>(modeljoined.year)<span class="op">-</span><span class="fl">4</span>)<span class="op">:</span><span class="fl">4</span><span class="op">:</span>(<span class="fu">maximum</span>(modeljoined.year)<span class="op">+</span><span class="fl">4</span>)]</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">7.0</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>modl <span class="op">=</span> <span class="fu">guns</span>(modeljoined.StateCode,<span class="fu">maximum</span>(modeljoined.StateCode),modeljoined.stgroup,<span class="fu">maximum</span>(modeljoined.stgroup),</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>        centers, width, modeljoined.year,<span class="fu">log</span>.(modeljoined.crudedeathrate),lawdates.year,statecoefpert)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="fu">setadbackend</span>(<span class="op">:</span>reversediff)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>Turing.<span class="fu">setrdcache</span>(<span class="cn">true</span>)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>savedfile <span class="op">=</span> <span class="st">"./saved/samples.dat"</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> s <span class="op">=</span> []</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="fu">stat</span>(savedfile).mtime <span class="op">&gt;</span> <span class="fu">stat</span>(<span class="st">"./model.jl"</span>).mtime</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> s <span class="op">=</span> <span class="fu">deserialize</span>(savedfile)</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> s <span class="op">=</span> <span class="fu">sample</span>(modl,<span class="fu">NUTS</span>(<span class="fl">500</span>,<span class="fl">0.8</span>),<span class="fu">MCMCThreads</span>(),<span class="fl">500</span>,<span class="fl">3</span>)</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">serialize</span>(savedfile,s)</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (500×957×3 Array{Float64, 3}):
Iterations        = 1:1:500
Number of chains  = 3
Samples per chain = 500
parameters        = lawrate, meanlawcoef, nationcoefs[1], nationcoefs[2], nationcoefs[3], nationcoefs[4], nationcoefs[5], nationcoefs[6], nationcoefs[7], nationcoefs[8], nationcoefs[9], nationcoefs[10], nationcoefs[11], nationcoefs[12], nationcoefs[13], regioncoefs[1][1], regioncoefs[1][2], regioncoefs[1][3], regioncoefs[1][4], regioncoefs[1][5], regioncoefs[1][6], regioncoefs[1][7], regioncoefs[1][8], regioncoefs[1][9], regioncoefs[1][10], regioncoefs[1][11], regioncoefs[1][12], regioncoefs[1][13], regioncoefs[2][1], regioncoefs[2][2], regioncoefs[2][3], regioncoefs[2][4], regioncoefs[2][5], regioncoefs[2][6], regioncoefs[2][7], regioncoefs[2][8], regioncoefs[2][9], regioncoefs[2][10], regioncoefs[2][11], regioncoefs[2][12], regioncoefs[2][13], regioncoefs[3][1], regioncoefs[3][2], regioncoefs[3][3], regioncoefs[3][4], regioncoefs[3][5], regioncoefs[3][6], regioncoefs[3][7], regioncoefs[3][8], regioncoefs[3][9], regioncoefs[3][10], regioncoefs[3][11], regioncoefs[3][12], regioncoefs[3][13], regioncoefs[4][1], regioncoefs[4][2], regioncoefs[4][3], regioncoefs[4][4], regioncoefs[4][5], regioncoefs[4][6], regioncoefs[4][7], regioncoefs[4][8], regioncoefs[4][9], regioncoefs[4][10], regioncoefs[4][11], regioncoefs[4][12], regioncoefs[4][13], regioncoefs[5][1], regioncoefs[5][2], regioncoefs[5][3], regioncoefs[5][4], regioncoefs[5][5], regioncoefs[5][6], regioncoefs[5][7], regioncoefs[5][8], regioncoefs[5][9], regioncoefs[5][10], regioncoefs[5][11], regioncoefs[5][12], regioncoefs[5][13], regioncoefs[6][1], regioncoefs[6][2], regioncoefs[6][3], regioncoefs[6][4], regioncoefs[6][5], regioncoefs[6][6], regioncoefs[6][7], regioncoefs[6][8], regioncoefs[6][9], regioncoefs[6][10], regioncoefs[6][11], regioncoefs[6][12], regioncoefs[6][13], regioncoefs[7][1], regioncoefs[7][2], regioncoefs[7][3], regioncoefs[7][4], regioncoefs[7][5], regioncoefs[7][6], regioncoefs[7][7], regioncoefs[7][8], regioncoefs[7][9], regioncoefs[7][10], regioncoefs[7][11], regioncoefs[7][12], regioncoefs[7][13], regioncoefs[8][1], regioncoefs[8][2], regioncoefs[8][3], regioncoefs[8][4], regioncoefs[8][5], regioncoefs[8][6], regioncoefs[8][7], regioncoefs[8][8], regioncoefs[8][9], regioncoefs[8][10], regioncoefs[8][11], regioncoefs[8][12], regioncoefs[8][13], scale, statebase[1], statebase[2], statebase[3], statebase[4], statebase[5], statebase[6], statebase[7], statebase[8], statebase[9], statebase[10], statebase[11], statebase[12], statebase[13], statebase[14], statebase[15], statebase[16], statebase[17], statebase[18], statebase[19], statebase[20], statebase[21], statebase[22], statebase[23], statebase[24], statebase[25], statebase[26], statebase[27], statebase[28], statebase[29], statebase[30], statebase[31], statebase[32], statebase[33], statebase[34], statebase[35], statebase[36], statebase[37], statebase[38], statebase[39], statebase[40], statebase[41], statebase[42], statebase[43], statebase[44], statebase[45], statebase[46], statebase[47], statebase[48], statebase[49], statebase[50], statebase[51], statebase[52], statebase[53], statebase[54], statebase[55], statecoefs[1][1], statecoefs[1][2], statecoefs[1][3], statecoefs[1][4], statecoefs[1][5], statecoefs[1][6], statecoefs[1][7], statecoefs[1][8], statecoefs[1][9], statecoefs[1][10], statecoefs[1][11], statecoefs[1][12], statecoefs[1][13], statecoefs[2][1], statecoefs[2][2], statecoefs[2][3], statecoefs[2][4], statecoefs[2][5], statecoefs[2][6], statecoefs[2][7], statecoefs[2][8], statecoefs[2][9], statecoefs[2][10], statecoefs[2][11], statecoefs[2][12], statecoefs[2][13], statecoefs[3][1], statecoefs[3][2], statecoefs[3][3], statecoefs[3][4], statecoefs[3][5], statecoefs[3][6], statecoefs[3][7], statecoefs[3][8], statecoefs[3][9], statecoefs[3][10], statecoefs[3][11], statecoefs[3][12], statecoefs[3][13], statecoefs[4][1], statecoefs[4][2], statecoefs[4][3], statecoefs[4][4], statecoefs[4][5], statecoefs[4][6], statecoefs[4][7], statecoefs[4][8], statecoefs[4][9], statecoefs[4][10], statecoefs[4][11], statecoefs[4][12], statecoefs[4][13], statecoefs[5][1], statecoefs[5][2], statecoefs[5][3], statecoefs[5][4], statecoefs[5][5], statecoefs[5][6], statecoefs[5][7], statecoefs[5][8], statecoefs[5][9], statecoefs[5][10], statecoefs[5][11], statecoefs[5][12], statecoefs[5][13], statecoefs[6][1], statecoefs[6][2], statecoefs[6][3], statecoefs[6][4], statecoefs[6][5], statecoefs[6][6], statecoefs[6][7], statecoefs[6][8], statecoefs[6][9], statecoefs[6][10], statecoefs[6][11], statecoefs[6][12], statecoefs[6][13], statecoefs[7][1], statecoefs[7][2], statecoefs[7][3], statecoefs[7][4], statecoefs[7][5], statecoefs[7][6], statecoefs[7][7], statecoefs[7][8], statecoefs[7][9], statecoefs[7][10], statecoefs[7][11], statecoefs[7][12], statecoefs[7][13], statecoefs[8][1], statecoefs[8][2], statecoefs[8][3], statecoefs[8][4], statecoefs[8][5], statecoefs[8][6], statecoefs[8][7], statecoefs[8][8], statecoefs[8][9], statecoefs[8][10], statecoefs[8][11], statecoefs[8][12], statecoefs[8][13], statecoefs[9][1], statecoefs[9][2], statecoefs[9][3], statecoefs[9][4], statecoefs[9][5], statecoefs[9][6], statecoefs[9][7], statecoefs[9][8], statecoefs[9][9], statecoefs[9][10], statecoefs[9][11], statecoefs[9][12], statecoefs[9][13], statecoefs[10][1], statecoefs[10][2], statecoefs[10][3], statecoefs[10][4], statecoefs[10][5], statecoefs[10][6], statecoefs[10][7], statecoefs[10][8], statecoefs[10][9], statecoefs[10][10], statecoefs[10][11], statecoefs[10][12], statecoefs[10][13], statecoefs[11][1], statecoefs[11][2], statecoefs[11][3], statecoefs[11][4], statecoefs[11][5], statecoefs[11][6], statecoefs[11][7], statecoefs[11][8], statecoefs[11][9], statecoefs[11][10], statecoefs[11][11], statecoefs[11][12], statecoefs[11][13], statecoefs[12][1], statecoefs[12][2], statecoefs[12][3], statecoefs[12][4], statecoefs[12][5], statecoefs[12][6], statecoefs[12][7], statecoefs[12][8], statecoefs[12][9], statecoefs[12][10], statecoefs[12][11], statecoefs[12][12], statecoefs[12][13], statecoefs[13][1], statecoefs[13][2], statecoefs[13][3], statecoefs[13][4], statecoefs[13][5], statecoefs[13][6], statecoefs[13][7], statecoefs[13][8], statecoefs[13][9], statecoefs[13][10], statecoefs[13][11], statecoefs[13][12], statecoefs[13][13], statecoefs[14][1], statecoefs[14][2], statecoefs[14][3], statecoefs[14][4], statecoefs[14][5], statecoefs[14][6], statecoefs[14][7], statecoefs[14][8], statecoefs[14][9], statecoefs[14][10], statecoefs[14][11], statecoefs[14][12], statecoefs[14][13], statecoefs[15][1], statecoefs[15][2], statecoefs[15][3], statecoefs[15][4], statecoefs[15][5], statecoefs[15][6], statecoefs[15][7], statecoefs[15][8], statecoefs[15][9], statecoefs[15][10], statecoefs[15][11], statecoefs[15][12], statecoefs[15][13], statecoefs[16][1], statecoefs[16][2], statecoefs[16][3], statecoefs[16][4], statecoefs[16][5], statecoefs[16][6], statecoefs[16][7], statecoefs[16][8], statecoefs[16][9], statecoefs[16][10], statecoefs[16][11], statecoefs[16][12], statecoefs[16][13], statecoefs[17][1], statecoefs[17][2], statecoefs[17][3], statecoefs[17][4], statecoefs[17][5], statecoefs[17][6], statecoefs[17][7], statecoefs[17][8], statecoefs[17][9], statecoefs[17][10], statecoefs[17][11], statecoefs[17][12], statecoefs[17][13], statecoefs[18][1], statecoefs[18][2], statecoefs[18][3], statecoefs[18][4], statecoefs[18][5], statecoefs[18][6], statecoefs[18][7], statecoefs[18][8], statecoefs[18][9], statecoefs[18][10], statecoefs[18][11], statecoefs[18][12], statecoefs[18][13], statecoefs[19][1], statecoefs[19][2], statecoefs[19][3], statecoefs[19][4], statecoefs[19][5], statecoefs[19][6], statecoefs[19][7], statecoefs[19][8], statecoefs[19][9], statecoefs[19][10], statecoefs[19][11], statecoefs[19][12], statecoefs[19][13], statecoefs[20][1], statecoefs[20][2], statecoefs[20][3], statecoefs[20][4], statecoefs[20][5], statecoefs[20][6], statecoefs[20][7], statecoefs[20][8], statecoefs[20][9], statecoefs[20][10], statecoefs[20][11], statecoefs[20][12], statecoefs[20][13], statecoefs[21][1], statecoefs[21][2], statecoefs[21][3], statecoefs[21][4], statecoefs[21][5], statecoefs[21][6], statecoefs[21][7], statecoefs[21][8], statecoefs[21][9], statecoefs[21][10], statecoefs[21][11], statecoefs[21][12], statecoefs[21][13], statecoefs[22][1], statecoefs[22][2], statecoefs[22][3], statecoefs[22][4], statecoefs[22][5], statecoefs[22][6], statecoefs[22][7], statecoefs[22][8], statecoefs[22][9], statecoefs[22][10], statecoefs[22][11], statecoefs[22][12], statecoefs[22][13], statecoefs[23][1], statecoefs[23][2], statecoefs[23][3], statecoefs[23][4], statecoefs[23][5], statecoefs[23][6], statecoefs[23][7], statecoefs[23][8], statecoefs[23][9], statecoefs[23][10], statecoefs[23][11], statecoefs[23][12], statecoefs[23][13], statecoefs[24][1], statecoefs[24][2], statecoefs[24][3], statecoefs[24][4], statecoefs[24][5], statecoefs[24][6], statecoefs[24][7], statecoefs[24][8], statecoefs[24][9], statecoefs[24][10], statecoefs[24][11], statecoefs[24][12], statecoefs[24][13], statecoefs[25][1], statecoefs[25][2], statecoefs[25][3], statecoefs[25][4], statecoefs[25][5], statecoefs[25][6], statecoefs[25][7], statecoefs[25][8], statecoefs[25][9], statecoefs[25][10], statecoefs[25][11], statecoefs[25][12], statecoefs[25][13], statecoefs[26][1], statecoefs[26][2], statecoefs[26][3], statecoefs[26][4], statecoefs[26][5], statecoefs[26][6], statecoefs[26][7], statecoefs[26][8], statecoefs[26][9], statecoefs[26][10], statecoefs[26][11], statecoefs[26][12], statecoefs[26][13], statecoefs[27][1], statecoefs[27][2], statecoefs[27][3], statecoefs[27][4], statecoefs[27][5], statecoefs[27][6], statecoefs[27][7], statecoefs[27][8], statecoefs[27][9], statecoefs[27][10], statecoefs[27][11], statecoefs[27][12], statecoefs[27][13], statecoefs[28][1], statecoefs[28][2], statecoefs[28][3], statecoefs[28][4], statecoefs[28][5], statecoefs[28][6], statecoefs[28][7], statecoefs[28][8], statecoefs[28][9], statecoefs[28][10], statecoefs[28][11], statecoefs[28][12], statecoefs[28][13], statecoefs[29][1], statecoefs[29][2], statecoefs[29][3], statecoefs[29][4], statecoefs[29][5], statecoefs[29][6], statecoefs[29][7], statecoefs[29][8], statecoefs[29][9], statecoefs[29][10], statecoefs[29][11], statecoefs[29][12], statecoefs[29][13], statecoefs[30][1], statecoefs[30][2], statecoefs[30][3], statecoefs[30][4], statecoefs[30][5], statecoefs[30][6], statecoefs[30][7], statecoefs[30][8], statecoefs[30][9], statecoefs[30][10], statecoefs[30][11], statecoefs[30][12], statecoefs[30][13], statecoefs[31][1], statecoefs[31][2], statecoefs[31][3], statecoefs[31][4], statecoefs[31][5], statecoefs[31][6], statecoefs[31][7], statecoefs[31][8], statecoefs[31][9], statecoefs[31][10], statecoefs[31][11], statecoefs[31][12], statecoefs[31][13], statecoefs[32][1], statecoefs[32][2], statecoefs[32][3], statecoefs[32][4], statecoefs[32][5], statecoefs[32][6], statecoefs[32][7], statecoefs[32][8], statecoefs[32][9], statecoefs[32][10], statecoefs[32][11], statecoefs[32][12], statecoefs[32][13], statecoefs[33][1], statecoefs[33][2], statecoefs[33][3], statecoefs[33][4], statecoefs[33][5], statecoefs[33][6], statecoefs[33][7], statecoefs[33][8], statecoefs[33][9], statecoefs[33][10], statecoefs[33][11], statecoefs[33][12], statecoefs[33][13], statecoefs[34][1], statecoefs[34][2], statecoefs[34][3], statecoefs[34][4], statecoefs[34][5], statecoefs[34][6], statecoefs[34][7], statecoefs[34][8], statecoefs[34][9], statecoefs[34][10], statecoefs[34][11], statecoefs[34][12], statecoefs[34][13], statecoefs[35][1], statecoefs[35][2], statecoefs[35][3], statecoefs[35][4], statecoefs[35][5], statecoefs[35][6], statecoefs[35][7], statecoefs[35][8], statecoefs[35][9], statecoefs[35][10], statecoefs[35][11], statecoefs[35][12], statecoefs[35][13], statecoefs[36][1], statecoefs[36][2], statecoefs[36][3], statecoefs[36][4], statecoefs[36][5], statecoefs[36][6], statecoefs[36][7], statecoefs[36][8], statecoefs[36][9], statecoefs[36][10], statecoefs[36][11], statecoefs[36][12], statecoefs[36][13], statecoefs[37][1], statecoefs[37][2], statecoefs[37][3], statecoefs[37][4], statecoefs[37][5], statecoefs[37][6], statecoefs[37][7], statecoefs[37][8], statecoefs[37][9], statecoefs[37][10], statecoefs[37][11], statecoefs[37][12], statecoefs[37][13], statecoefs[38][1], statecoefs[38][2], statecoefs[38][3], statecoefs[38][4], statecoefs[38][5], statecoefs[38][6], statecoefs[38][7], statecoefs[38][8], statecoefs[38][9], statecoefs[38][10], statecoefs[38][11], statecoefs[38][12], statecoefs[38][13], statecoefs[39][1], statecoefs[39][2], statecoefs[39][3], statecoefs[39][4], statecoefs[39][5], statecoefs[39][6], statecoefs[39][7], statecoefs[39][8], statecoefs[39][9], statecoefs[39][10], statecoefs[39][11], statecoefs[39][12], statecoefs[39][13], statecoefs[40][1], statecoefs[40][2], statecoefs[40][3], statecoefs[40][4], statecoefs[40][5], statecoefs[40][6], statecoefs[40][7], statecoefs[40][8], statecoefs[40][9], statecoefs[40][10], statecoefs[40][11], statecoefs[40][12], statecoefs[40][13], statecoefs[41][1], statecoefs[41][2], statecoefs[41][3], statecoefs[41][4], statecoefs[41][5], statecoefs[41][6], statecoefs[41][7], statecoefs[41][8], statecoefs[41][9], statecoefs[41][10], statecoefs[41][11], statecoefs[41][12], statecoefs[41][13], statecoefs[42][1], statecoefs[42][2], statecoefs[42][3], statecoefs[42][4], statecoefs[42][5], statecoefs[42][6], statecoefs[42][7], statecoefs[42][8], statecoefs[42][9], statecoefs[42][10], statecoefs[42][11], statecoefs[42][12], statecoefs[42][13], statecoefs[43][1], statecoefs[43][2], statecoefs[43][3], statecoefs[43][4], statecoefs[43][5], statecoefs[43][6], statecoefs[43][7], statecoefs[43][8], statecoefs[43][9], statecoefs[43][10], statecoefs[43][11], statecoefs[43][12], statecoefs[43][13], statecoefs[44][1], statecoefs[44][2], statecoefs[44][3], statecoefs[44][4], statecoefs[44][5], statecoefs[44][6], statecoefs[44][7], statecoefs[44][8], statecoefs[44][9], statecoefs[44][10], statecoefs[44][11], statecoefs[44][12], statecoefs[44][13], statecoefs[45][1], statecoefs[45][2], statecoefs[45][3], statecoefs[45][4], statecoefs[45][5], statecoefs[45][6], statecoefs[45][7], statecoefs[45][8], statecoefs[45][9], statecoefs[45][10], statecoefs[45][11], statecoefs[45][12], statecoefs[45][13], statecoefs[46][1], statecoefs[46][2], statecoefs[46][3], statecoefs[46][4], statecoefs[46][5], statecoefs[46][6], statecoefs[46][7], statecoefs[46][8], statecoefs[46][9], statecoefs[46][10], statecoefs[46][11], statecoefs[46][12], statecoefs[46][13], statecoefs[47][1], statecoefs[47][2], statecoefs[47][3], statecoefs[47][4], statecoefs[47][5], statecoefs[47][6], statecoefs[47][7], statecoefs[47][8], statecoefs[47][9], statecoefs[47][10], statecoefs[47][11], statecoefs[47][12], statecoefs[47][13], statecoefs[48][1], statecoefs[48][2], statecoefs[48][3], statecoefs[48][4], statecoefs[48][5], statecoefs[48][6], statecoefs[48][7], statecoefs[48][8], statecoefs[48][9], statecoefs[48][10], statecoefs[48][11], statecoefs[48][12], statecoefs[48][13], statecoefs[49][1], statecoefs[49][2], statecoefs[49][3], statecoefs[49][4], statecoefs[49][5], statecoefs[49][6], statecoefs[49][7], statecoefs[49][8], statecoefs[49][9], statecoefs[49][10], statecoefs[49][11], statecoefs[49][12], statecoefs[49][13], statecoefs[50][1], statecoefs[50][2], statecoefs[50][3], statecoefs[50][4], statecoefs[50][5], statecoefs[50][6], statecoefs[50][7], statecoefs[50][8], statecoefs[50][9], statecoefs[50][10], statecoefs[50][11], statecoefs[50][12], statecoefs[50][13], statecoefs[51][1], statecoefs[51][2], statecoefs[51][3], statecoefs[51][4], statecoefs[51][5], statecoefs[51][6], statecoefs[51][7], statecoefs[51][8], statecoefs[51][9], statecoefs[51][10], statecoefs[51][11], statecoefs[51][12], statecoefs[51][13], statecoefs[52][1], statecoefs[52][2], statecoefs[52][3], statecoefs[52][4], statecoefs[52][5], statecoefs[52][6], statecoefs[52][7], statecoefs[52][8], statecoefs[52][9], statecoefs[52][10], statecoefs[52][11], statecoefs[52][12], statecoefs[52][13], statecoefs[53][1], statecoefs[53][2], statecoefs[53][3], statecoefs[53][4], statecoefs[53][5], statecoefs[53][6], statecoefs[53][7], statecoefs[53][8], statecoefs[53][9], statecoefs[53][10], statecoefs[53][11], statecoefs[53][12], statecoefs[53][13], statecoefs[54][1], statecoefs[54][2], statecoefs[54][3], statecoefs[54][4], statecoefs[54][5], statecoefs[54][6], statecoefs[54][7], statecoefs[54][8], statecoefs[54][9], statecoefs[54][10], statecoefs[54][11], statecoefs[54][12], statecoefs[54][13], statecoefs[55][1], statecoefs[55][2], statecoefs[55][3], statecoefs[55][4], statecoefs[55][5], statecoefs[55][6], statecoefs[55][7], statecoefs[55][8], statecoefs[55][9], statecoefs[55][10], statecoefs[55][11], statecoefs[55][12], statecoefs[55][13], statelawcoef[1], statelawcoef[2], statelawcoef[3], statelawcoef[4], statelawcoef[5], statelawcoef[6], statelawcoef[7], statelawcoef[8], statelawcoef[9], statelawcoef[10], statelawcoef[11], statelawcoef[12], statelawcoef[13], statelawcoef[14], statelawcoef[15], statelawcoef[16], statelawcoef[17], statelawcoef[18], statelawcoef[19], statelawcoef[20], statelawcoef[21], statelawcoef[22], statelawcoef[23], statelawcoef[24], statelawcoef[25], statelawcoef[26], statelawcoef[27], statelawcoef[28], statelawcoef[29], statelawcoef[30], statelawcoef[31], statelawcoef[32], statelawcoef[33], statelawcoef[34], statelawcoef[35], statelawcoef[36], statelawcoef[37], statelawcoef[38], statelawcoef[39], statelawcoef[40], statelawcoef[41], statelawcoef[42], statelawcoef[43], statelawcoef[44], statelawcoef[45], statelawcoef[46], statelawcoef[47], statelawcoef[48], statelawcoef[49], statelawcoef[50], statelawcoef[51], statelawcoef[52], statelawcoef[53], statelawcoef[54], statelawcoef[55]
internals         = acceptance_rate, hamiltonian_energy, hamiltonian_energy_error, is_accept, log_density, lp, max_hamiltonian_energy_error, n_steps, nom_step_size, numerical_error, step_size, tree_depth
Summary Statistics
 <span class="ansi-bold">         parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold"> naive_se </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">       ess </span> <span class="ansi-bold">   </span> ⋯
 <span class="ansi-bright-black-fg">             Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Fl</span> ⋯
             lawrate    3.8170    1.6859     0.0435    0.0290   4401.7156    0 ⋯
         meanlawcoef    0.0801    0.0743     0.0019    0.0022   1550.7673    0 ⋯
      nationcoefs[1]    0.0413    0.6867     0.0177    0.0118   5151.1657    0 ⋯
      nationcoefs[2]    0.1072    0.6759     0.0175    0.0110   5355.9487    0 ⋯
      nationcoefs[3]    0.0781    0.6578     0.0170    0.0107   3715.4405    0 ⋯
      nationcoefs[4]   -0.1930    0.6825     0.0176    0.0120   6023.9144    0 ⋯
      nationcoefs[5]    0.2366    0.6622     0.0171    0.0113   3495.8956    0 ⋯
      nationcoefs[6]    0.0435    0.6878     0.0178    0.0123   3774.1711    0 ⋯
      nationcoefs[7]   -0.1013    0.6663     0.0172    0.0124   2997.4910    0 ⋯
      nationcoefs[8]   -0.0672    0.6196     0.0160    0.0122   3948.0602    0 ⋯
      nationcoefs[9]   -0.0805    0.6410     0.0166    0.0116   3932.8216    0 ⋯
     nationcoefs[10]   -0.1387    0.6824     0.0176    0.0122   3352.7558    0 ⋯
     nationcoefs[11]   -0.2410    0.6789     0.0175    0.0091   3833.5662    0 ⋯
     nationcoefs[12]    0.1704    0.6991     0.0181    0.0117   4266.2348    1 ⋯
     nationcoefs[13]   -0.0343    0.6660     0.0172    0.0117   3787.7307    0 ⋯
   regioncoefs[1][1]    0.0463    0.1469     0.0038    0.0047    966.7836    1 ⋯
   regioncoefs[1][2]    0.0055    0.1368     0.0035    0.0043    760.7266    0 ⋯
   regioncoefs[1][3]    0.1845    0.1378     0.0036    0.0052    706.6964    1 ⋯
   regioncoefs[1][4]   -0.3022    0.1296     0.0033    0.0046    672.7709    1 ⋯
   regioncoefs[1][5]    0.2548    0.1268     0.0033    0.0050    609.4119    1 ⋯
   regioncoefs[1][6]    0.0852    0.1190     0.0031    0.0045    606.7495    1 ⋯
   regioncoefs[1][7]   -0.1090    0.1243     0.0032    0.0052    580.2901    1 ⋯
   regioncoefs[1][8]   -0.1379    0.1195     0.0031    0.0044    618.0759    1 ⋯
          ⋮               ⋮         ⋮         ⋮          ⋮          ⋮          ⋱
<span class="ansi-cyan-fg">                                                   1 column and 922 rows omitted</span>
Quantiles
 <span class="ansi-bold">         parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">             Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>
             lawrate    1.2860    2.5526    3.5952    4.8667    7.5789
         meanlawcoef   -0.0600    0.0308    0.0769    0.1286    0.2305
      nationcoefs[1]   -1.3038   -0.4206    0.0530    0.4883    1.3601
      nationcoefs[2]   -1.2417   -0.3278    0.0893    0.5544    1.4339
      nationcoefs[3]   -1.1549   -0.3703    0.0693    0.5351    1.3838
      nationcoefs[4]   -1.5496   -0.6589   -0.1902    0.2819    1.1394
      nationcoefs[5]   -1.1076   -0.1814    0.2407    0.6636    1.5180
      nationcoefs[6]   -1.3414   -0.4145    0.0626    0.5124    1.3563
      nationcoefs[7]   -1.3626   -0.5561   -0.1082    0.3487    1.2005
      nationcoefs[8]   -1.2456   -0.4899   -0.0769    0.3145    1.2251
      nationcoefs[9]   -1.3541   -0.5023   -0.0813    0.3565    1.1455
     nationcoefs[10]   -1.4624   -0.6175   -0.1640    0.3601    1.1430
     nationcoefs[11]   -1.5876   -0.7335   -0.2238    0.2244    1.1076
     nationcoefs[12]   -1.2614   -0.2775    0.1811    0.6277    1.5597
     nationcoefs[13]   -1.2869   -0.5087   -0.0510    0.4281    1.2845
   regioncoefs[1][1]   -0.2448   -0.0539    0.0454    0.1473    0.3402
   regioncoefs[1][2]   -0.2557   -0.0850    0.0013    0.1010    0.2735
   regioncoefs[1][3]   -0.0967    0.0985    0.1816    0.2700    0.4608
   regioncoefs[1][4]   -0.5491   -0.3894   -0.3052   -0.2129   -0.0416
   regioncoefs[1][5]    0.0039    0.1718    0.2549    0.3322    0.5198
   regioncoefs[1][6]   -0.1424    0.0043    0.0845    0.1593    0.3240
   regioncoefs[1][7]   -0.3363   -0.1922   -0.1132   -0.0275    0.1429
   regioncoefs[1][8]   -0.3725   -0.2160   -0.1408   -0.0616    0.1019
          ⋮               ⋮         ⋮         ⋮         ⋮         ⋮
<span class="ansi-cyan-fg">                                                        922 rows omitted</span>
</pre>
</div>
</div>
</div>
<p>Having sampled the model, we can then compute summary graphs of the results. We will show the posterior density for the coefficient of the magnitude of the law effect for each state separately.</p>
<p>Also we will plot the actual log(homicide rate) together with the state specific counterfactual estimates.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>lawco <span class="op">=</span> <span class="fu">group</span>(s,<span class="st">"statelawcoef"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>statenames <span class="op">=</span> <span class="fu">Dict</span>()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (st,stusab) <span class="kw">in</span> <span class="bu">Iterators</span>.<span class="fu">zip</span>(lawdates.STATE,lawdates.STUSAB)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    statenames[st] <span class="op">=</span> stusab</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plotlawts</span>(s,lawdates,modeljoined)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> pl <span class="op">=</span> []</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    lawco <span class="op">=</span> <span class="fu">group</span>(s,<span class="st">"statelawcoef"</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="pp">@select</span>(<span class="pp">@subset</span>(lawdates,<span class="op">:</span>year <span class="op">.&lt;</span> <span class="fl">2022</span>),<span class="op">:</span>STATE).STATE</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        den <span class="op">=</span> <span class="fu">density</span>(s[<span class="op">:</span>,<span class="fu">Symbol</span>(<span class="st">"meanlawcoef"</span>),<span class="op">:</span>] <span class="op">.+</span> lawco[<span class="op">:</span>,<span class="fu">Symbol</span>(<span class="st">"statelawcoef[</span><span class="sc">$</span>i<span class="st">]"</span>),<span class="op">:</span>], title <span class="op">=</span> <span class="st">"State </span><span class="sc">$</span>i<span class="st"> = </span><span class="sc">$</span>(statenames[i])<span class="st">"</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>            legend<span class="op">=</span><span class="cn">false</span>,xlim<span class="op">=</span>(<span class="fu">-log</span>(<span class="fl">2</span>),<span class="fu">log</span>(<span class="fl">2</span>)))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot!</span>([(<span class="fl">0.0</span>,<span class="fl">0.0</span>),(<span class="fl">0.0</span>,<span class="fl">5.0</span>)], color<span class="op">=</span><span class="st">"red"</span>,ylim<span class="op">=</span>(<span class="fl">0.0</span>,<span class="fl">5.0</span>))</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(pl,den)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"State law coefficient values"</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(<span class="fu">plot</span>(pl<span class="op">...</span>; size <span class="op">=</span> (<span class="fl">1000</span>,<span class="fl">1000</span>)))</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(<span class="fu">density</span>(s[<span class="op">:</span>,<span class="op">:</span>lawrate,<span class="op">:</span>], title<span class="op">=</span> <span class="st">"Law effect onset rate (1/yr)"</span>))</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    modeljoined.logdrate <span class="op">=</span> <span class="fu">log</span>.(modeljoined.crudedeathrate)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    regions <span class="op">=</span> <span class="fu">Dict</span>()</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> <span class="fu">eachrow</span>(stategroupdf)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        regions[r.STATE] <span class="op">=</span> (group<span class="op">=</span>r.stgroup,code<span class="op">=</span>r.STUSAB)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    pl <span class="op">=</span> []</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    samps <span class="op">=</span> <span class="fu">sample</span>(<span class="fl">1</span><span class="op">:</span><span class="fl">500</span>,<span class="fl">10</span>)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> st <span class="kw">in</span> <span class="fu">unique</span>(modeljoined.STATE)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> <span class="pp">@subset</span>(modeljoined, <span class="op">:</span>STATE <span class="op">.==</span> st)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        region <span class="op">=</span> regions[st].group</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="fu">plot</span>(sub.year,sub.logdrate,linewidth<span class="op">=</span><span class="fl">3</span>,title<span class="op">=</span><span class="st">"</span><span class="sc">$</span>(st)<span class="st"> = </span><span class="sc">$</span>(regions[st].code)<span class="st">"</span>,ylim<span class="op">=</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">2.75</span>))</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(pl,p)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> samp <span class="kw">in</span> samps</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>            statelawcoef <span class="op">=</span> s[samp,<span class="fu">Symbol</span>(<span class="st">"statelawcoef[</span><span class="sc">$</span>st<span class="st">]"</span>),<span class="fl">1</span>]</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>            statecoefs <span class="op">=</span> [s[samp,<span class="fu">Symbol</span>(<span class="st">"statecoefs[</span><span class="sc">$</span>st<span class="st">][</span><span class="sc">$</span>i<span class="st">]"</span>),<span class="fl">1</span>] for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(centers)]</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>            statebase <span class="op">=</span> s[samp,<span class="fu">Symbol</span>(<span class="st">"statebase[</span><span class="sc">$</span>st<span class="st">]"</span>),<span class="fl">1</span>]</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>            regioncoefs <span class="op">=</span> [s[samp,<span class="fu">Symbol</span>(<span class="st">"regioncoefs[</span><span class="sc">$</span>region<span class="st">][</span><span class="sc">$</span>i<span class="st">]"</span>),<span class="fl">1</span>] for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(centers)]        </span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>            lawrate <span class="op">=</span> s[samp,<span class="op">:</span>lawrate,<span class="fl">1</span>]</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>            startlaw <span class="op">=</span> lawdates[lawdates.STATE <span class="op">.==</span> st,<span class="op">:</span>].year[<span class="fl">1</span>]</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>            startlaw <span class="op">=</span> <span class="fu">ismissing</span>(startlaw) ? <span class="fl">3000</span> <span class="op">:</span> startlaw</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>            years <span class="op">=</span> <span class="fl">1979</span><span class="op">:</span><span class="fl">2020</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>            pred <span class="op">=</span> [statebase <span class="op">+</span> </span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>                <span class="fu">timeser</span>(yr,regioncoefs <span class="op">.+</span> (statecoefpert <span class="op">.*</span> statecoefs),centers,width) for yr <span class="kw">in</span> years]</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plot!</span>(years,pred; color<span class="op">=</span><span class="st">"orange"</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> startlaw <span class="op">&lt;</span> <span class="fl">3000</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>                <span class="fu">plot!</span>([(startlaw,<span class="op">-</span><span class="fl">10.0</span>),(startlaw,<span class="fl">10.0</span>)],color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>            regpred <span class="op">=</span> [statebase <span class="op">+</span> </span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>                <span class="fu">timeser</span>(yr,regioncoefs ,centers,width) for yr <span class="kw">in</span> years]</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"Each state shown with its locally estimated counterfactual (orange), actual (dark blue), and date of CC law if any (red vertical)"</span>)</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(<span class="fu">plot</span>(pl<span class="op">...</span>; size <span class="op">=</span>(<span class="fl">2000</span>,<span class="fl">3000</span>), legend<span class="op">=</span><span class="cn">false</span>))</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a><span class="fu">density</span>(s[<span class="op">:</span>,<span class="op">:</span>meanlawcoef,<span class="op">:</span>],title<span class="op">=</span><span class="st">"Mean law coefficient"</span>)</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a><span class="fu">plotlawts</span>(s,lawdates,modeljoined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>State law coefficient values</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-11-output-2.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-11-output-3.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Each state shown with its locally estimated counterfactual (orange), actual (dark blue), and date of CC law if any (red vertical)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-11-output-5.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<p><img src="USCarry_files/figure-html/cell-11-output-6.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="shall-issue-vs-permitless" class="level1">
<h1>Shall-issue vs permitless</h1>
<p>One plausible explanation for the relative lack of clear measurable effect from permitless carry laws is that permitless actually may have had very little effect on how many people carry firearms in public. Many of these states were shall-issue and many people who wanted to carry may have had CCW permits issued before the permitless law passed. Therefore the change in number of people carrying may have been minimal.</p>
<p>Using the date on which states converted to shall-issue permits, with a similar analysis, we can determine whether more of an effect was visible after that legal change. Some states converted from no-issue to shall issue, while others converted from may-issue to shall-issue.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dates collected from https://en.wikipedia.org/wiki/History_of_concealed_carry_in_the_United_States</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>shallissdates <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"data/ShallIssueDates.csv"</span>,DataFrame)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>shallissue <span class="op">=</span> <span class="fu">leftjoin</span>(fipscodes,shallissdates; on <span class="op">=</span> <span class="op">:</span>STUSAB)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>silawdates <span class="op">=</span> <span class="pp">@chain</span> <span class="fu">leftjoin</span>(<span class="fu">DataFrame</span>(STATE<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">55</span>),shallissue; on<span class="op">=:</span>STATE) <span class="cf">begin</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span>(<span class="op">:</span>STATE <span class="op">.&lt;</span> <span class="fl">60</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rtransform</span>(<span class="op">:</span>year <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>ShallIssueDate) ? <span class="fl">3000</span> <span class="op">:</span> <span class="op">:</span>ShallIssueDate)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span>(<span class="op">:</span>STATE)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>modl2 <span class="op">=</span> <span class="fu">guns</span>(modeljoined.StateCode,<span class="fu">maximum</span>(modeljoined.StateCode),modeljoined.stgroup,<span class="fu">maximum</span>(modeljoined.stgroup),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        centers, width, modeljoined.year,<span class="fu">log</span>.(modeljoined.crudedeathrate),silawdates.year,statecoefpert)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>savedfile <span class="op">=</span> <span class="st">"./saved/shallisssamples.dat"</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> sisam <span class="op">=</span> []</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="fu">stat</span>(savedfile).mtime <span class="op">&gt;</span> <span class="fu">stat</span>(<span class="st">"./model.jl"</span>).mtime</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> sisam <span class="op">=</span> <span class="fu">deserialize</span>(savedfile)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> sisam <span class="op">=</span> <span class="fu">sample</span>(modl2,<span class="fu">NUTS</span>(<span class="fl">500</span>,<span class="fl">0.8</span>),<span class="fu">MCMCThreads</span>(),<span class="fl">500</span>,<span class="fl">3</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">serialize</span>(savedfile,sisam)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (500×957×3 Array{Float64, 3}):
Iterations        = 1:1:500
Number of chains  = 3
Samples per chain = 500
parameters        = lawrate, meanlawcoef, nationcoefs[1], nationcoefs[2], nationcoefs[3], nationcoefs[4], nationcoefs[5], nationcoefs[6], nationcoefs[7], nationcoefs[8], nationcoefs[9], nationcoefs[10], nationcoefs[11], nationcoefs[12], nationcoefs[13], regioncoefs[1][1], regioncoefs[1][2], regioncoefs[1][3], regioncoefs[1][4], regioncoefs[1][5], regioncoefs[1][6], regioncoefs[1][7], regioncoefs[1][8], regioncoefs[1][9], regioncoefs[1][10], regioncoefs[1][11], regioncoefs[1][12], regioncoefs[1][13], regioncoefs[2][1], regioncoefs[2][2], regioncoefs[2][3], regioncoefs[2][4], regioncoefs[2][5], regioncoefs[2][6], regioncoefs[2][7], regioncoefs[2][8], regioncoefs[2][9], regioncoefs[2][10], regioncoefs[2][11], regioncoefs[2][12], regioncoefs[2][13], regioncoefs[3][1], regioncoefs[3][2], regioncoefs[3][3], regioncoefs[3][4], regioncoefs[3][5], regioncoefs[3][6], regioncoefs[3][7], regioncoefs[3][8], regioncoefs[3][9], regioncoefs[3][10], regioncoefs[3][11], regioncoefs[3][12], regioncoefs[3][13], regioncoefs[4][1], regioncoefs[4][2], regioncoefs[4][3], regioncoefs[4][4], regioncoefs[4][5], regioncoefs[4][6], regioncoefs[4][7], regioncoefs[4][8], regioncoefs[4][9], regioncoefs[4][10], regioncoefs[4][11], regioncoefs[4][12], regioncoefs[4][13], regioncoefs[5][1], regioncoefs[5][2], regioncoefs[5][3], regioncoefs[5][4], regioncoefs[5][5], regioncoefs[5][6], regioncoefs[5][7], regioncoefs[5][8], regioncoefs[5][9], regioncoefs[5][10], regioncoefs[5][11], regioncoefs[5][12], regioncoefs[5][13], regioncoefs[6][1], regioncoefs[6][2], regioncoefs[6][3], regioncoefs[6][4], regioncoefs[6][5], regioncoefs[6][6], regioncoefs[6][7], regioncoefs[6][8], regioncoefs[6][9], regioncoefs[6][10], regioncoefs[6][11], regioncoefs[6][12], regioncoefs[6][13], regioncoefs[7][1], regioncoefs[7][2], regioncoefs[7][3], regioncoefs[7][4], regioncoefs[7][5], regioncoefs[7][6], regioncoefs[7][7], regioncoefs[7][8], regioncoefs[7][9], regioncoefs[7][10], regioncoefs[7][11], regioncoefs[7][12], regioncoefs[7][13], regioncoefs[8][1], regioncoefs[8][2], regioncoefs[8][3], regioncoefs[8][4], regioncoefs[8][5], regioncoefs[8][6], regioncoefs[8][7], regioncoefs[8][8], regioncoefs[8][9], regioncoefs[8][10], regioncoefs[8][11], regioncoefs[8][12], regioncoefs[8][13], scale, statebase[1], statebase[2], statebase[3], statebase[4], statebase[5], statebase[6], statebase[7], statebase[8], statebase[9], statebase[10], statebase[11], statebase[12], statebase[13], statebase[14], statebase[15], statebase[16], statebase[17], statebase[18], statebase[19], statebase[20], statebase[21], statebase[22], statebase[23], statebase[24], statebase[25], statebase[26], statebase[27], statebase[28], statebase[29], statebase[30], statebase[31], statebase[32], statebase[33], statebase[34], statebase[35], statebase[36], statebase[37], statebase[38], statebase[39], statebase[40], statebase[41], statebase[42], statebase[43], statebase[44], statebase[45], statebase[46], statebase[47], statebase[48], statebase[49], statebase[50], statebase[51], statebase[52], statebase[53], statebase[54], statebase[55], statecoefs[1][1], statecoefs[1][2], statecoefs[1][3], statecoefs[1][4], statecoefs[1][5], statecoefs[1][6], statecoefs[1][7], statecoefs[1][8], statecoefs[1][9], statecoefs[1][10], statecoefs[1][11], statecoefs[1][12], statecoefs[1][13], statecoefs[2][1], statecoefs[2][2], statecoefs[2][3], statecoefs[2][4], statecoefs[2][5], statecoefs[2][6], statecoefs[2][7], statecoefs[2][8], statecoefs[2][9], statecoefs[2][10], statecoefs[2][11], statecoefs[2][12], statecoefs[2][13], statecoefs[3][1], statecoefs[3][2], statecoefs[3][3], statecoefs[3][4], statecoefs[3][5], statecoefs[3][6], statecoefs[3][7], statecoefs[3][8], statecoefs[3][9], statecoefs[3][10], statecoefs[3][11], statecoefs[3][12], statecoefs[3][13], statecoefs[4][1], statecoefs[4][2], statecoefs[4][3], statecoefs[4][4], statecoefs[4][5], statecoefs[4][6], statecoefs[4][7], statecoefs[4][8], statecoefs[4][9], statecoefs[4][10], statecoefs[4][11], statecoefs[4][12], statecoefs[4][13], statecoefs[5][1], statecoefs[5][2], statecoefs[5][3], statecoefs[5][4], statecoefs[5][5], statecoefs[5][6], statecoefs[5][7], statecoefs[5][8], statecoefs[5][9], statecoefs[5][10], statecoefs[5][11], statecoefs[5][12], statecoefs[5][13], statecoefs[6][1], statecoefs[6][2], statecoefs[6][3], statecoefs[6][4], statecoefs[6][5], statecoefs[6][6], statecoefs[6][7], statecoefs[6][8], statecoefs[6][9], statecoefs[6][10], statecoefs[6][11], statecoefs[6][12], statecoefs[6][13], statecoefs[7][1], statecoefs[7][2], statecoefs[7][3], statecoefs[7][4], statecoefs[7][5], statecoefs[7][6], statecoefs[7][7], statecoefs[7][8], statecoefs[7][9], statecoefs[7][10], statecoefs[7][11], statecoefs[7][12], statecoefs[7][13], statecoefs[8][1], statecoefs[8][2], statecoefs[8][3], statecoefs[8][4], statecoefs[8][5], statecoefs[8][6], statecoefs[8][7], statecoefs[8][8], statecoefs[8][9], statecoefs[8][10], statecoefs[8][11], statecoefs[8][12], statecoefs[8][13], statecoefs[9][1], statecoefs[9][2], statecoefs[9][3], statecoefs[9][4], statecoefs[9][5], statecoefs[9][6], statecoefs[9][7], statecoefs[9][8], statecoefs[9][9], statecoefs[9][10], statecoefs[9][11], statecoefs[9][12], statecoefs[9][13], statecoefs[10][1], statecoefs[10][2], statecoefs[10][3], statecoefs[10][4], statecoefs[10][5], statecoefs[10][6], statecoefs[10][7], statecoefs[10][8], statecoefs[10][9], statecoefs[10][10], statecoefs[10][11], statecoefs[10][12], statecoefs[10][13], statecoefs[11][1], statecoefs[11][2], statecoefs[11][3], statecoefs[11][4], statecoefs[11][5], statecoefs[11][6], statecoefs[11][7], statecoefs[11][8], statecoefs[11][9], statecoefs[11][10], statecoefs[11][11], statecoefs[11][12], statecoefs[11][13], statecoefs[12][1], statecoefs[12][2], statecoefs[12][3], statecoefs[12][4], statecoefs[12][5], statecoefs[12][6], statecoefs[12][7], statecoefs[12][8], statecoefs[12][9], statecoefs[12][10], statecoefs[12][11], statecoefs[12][12], statecoefs[12][13], statecoefs[13][1], statecoefs[13][2], statecoefs[13][3], statecoefs[13][4], statecoefs[13][5], statecoefs[13][6], statecoefs[13][7], statecoefs[13][8], statecoefs[13][9], statecoefs[13][10], statecoefs[13][11], statecoefs[13][12], statecoefs[13][13], statecoefs[14][1], statecoefs[14][2], statecoefs[14][3], statecoefs[14][4], statecoefs[14][5], statecoefs[14][6], statecoefs[14][7], statecoefs[14][8], statecoefs[14][9], statecoefs[14][10], statecoefs[14][11], statecoefs[14][12], statecoefs[14][13], statecoefs[15][1], statecoefs[15][2], statecoefs[15][3], statecoefs[15][4], statecoefs[15][5], statecoefs[15][6], statecoefs[15][7], statecoefs[15][8], statecoefs[15][9], statecoefs[15][10], statecoefs[15][11], statecoefs[15][12], statecoefs[15][13], statecoefs[16][1], statecoefs[16][2], statecoefs[16][3], statecoefs[16][4], statecoefs[16][5], statecoefs[16][6], statecoefs[16][7], statecoefs[16][8], statecoefs[16][9], statecoefs[16][10], statecoefs[16][11], statecoefs[16][12], statecoefs[16][13], statecoefs[17][1], statecoefs[17][2], statecoefs[17][3], statecoefs[17][4], statecoefs[17][5], statecoefs[17][6], statecoefs[17][7], statecoefs[17][8], statecoefs[17][9], statecoefs[17][10], statecoefs[17][11], statecoefs[17][12], statecoefs[17][13], statecoefs[18][1], statecoefs[18][2], statecoefs[18][3], statecoefs[18][4], statecoefs[18][5], statecoefs[18][6], statecoefs[18][7], statecoefs[18][8], statecoefs[18][9], statecoefs[18][10], statecoefs[18][11], statecoefs[18][12], statecoefs[18][13], statecoefs[19][1], statecoefs[19][2], statecoefs[19][3], statecoefs[19][4], statecoefs[19][5], statecoefs[19][6], statecoefs[19][7], statecoefs[19][8], statecoefs[19][9], statecoefs[19][10], statecoefs[19][11], statecoefs[19][12], statecoefs[19][13], statecoefs[20][1], statecoefs[20][2], statecoefs[20][3], statecoefs[20][4], statecoefs[20][5], statecoefs[20][6], statecoefs[20][7], statecoefs[20][8], statecoefs[20][9], statecoefs[20][10], statecoefs[20][11], statecoefs[20][12], statecoefs[20][13], statecoefs[21][1], statecoefs[21][2], statecoefs[21][3], statecoefs[21][4], statecoefs[21][5], statecoefs[21][6], statecoefs[21][7], statecoefs[21][8], statecoefs[21][9], statecoefs[21][10], statecoefs[21][11], statecoefs[21][12], statecoefs[21][13], statecoefs[22][1], statecoefs[22][2], statecoefs[22][3], statecoefs[22][4], statecoefs[22][5], statecoefs[22][6], statecoefs[22][7], statecoefs[22][8], statecoefs[22][9], statecoefs[22][10], statecoefs[22][11], statecoefs[22][12], statecoefs[22][13], statecoefs[23][1], statecoefs[23][2], statecoefs[23][3], statecoefs[23][4], statecoefs[23][5], statecoefs[23][6], statecoefs[23][7], statecoefs[23][8], statecoefs[23][9], statecoefs[23][10], statecoefs[23][11], statecoefs[23][12], statecoefs[23][13], statecoefs[24][1], statecoefs[24][2], statecoefs[24][3], statecoefs[24][4], statecoefs[24][5], statecoefs[24][6], statecoefs[24][7], statecoefs[24][8], statecoefs[24][9], statecoefs[24][10], statecoefs[24][11], statecoefs[24][12], statecoefs[24][13], statecoefs[25][1], statecoefs[25][2], statecoefs[25][3], statecoefs[25][4], statecoefs[25][5], statecoefs[25][6], statecoefs[25][7], statecoefs[25][8], statecoefs[25][9], statecoefs[25][10], statecoefs[25][11], statecoefs[25][12], statecoefs[25][13], statecoefs[26][1], statecoefs[26][2], statecoefs[26][3], statecoefs[26][4], statecoefs[26][5], statecoefs[26][6], statecoefs[26][7], statecoefs[26][8], statecoefs[26][9], statecoefs[26][10], statecoefs[26][11], statecoefs[26][12], statecoefs[26][13], statecoefs[27][1], statecoefs[27][2], statecoefs[27][3], statecoefs[27][4], statecoefs[27][5], statecoefs[27][6], statecoefs[27][7], statecoefs[27][8], statecoefs[27][9], statecoefs[27][10], statecoefs[27][11], statecoefs[27][12], statecoefs[27][13], statecoefs[28][1], statecoefs[28][2], statecoefs[28][3], statecoefs[28][4], statecoefs[28][5], statecoefs[28][6], statecoefs[28][7], statecoefs[28][8], statecoefs[28][9], statecoefs[28][10], statecoefs[28][11], statecoefs[28][12], statecoefs[28][13], statecoefs[29][1], statecoefs[29][2], statecoefs[29][3], statecoefs[29][4], statecoefs[29][5], statecoefs[29][6], statecoefs[29][7], statecoefs[29][8], statecoefs[29][9], statecoefs[29][10], statecoefs[29][11], statecoefs[29][12], statecoefs[29][13], statecoefs[30][1], statecoefs[30][2], statecoefs[30][3], statecoefs[30][4], statecoefs[30][5], statecoefs[30][6], statecoefs[30][7], statecoefs[30][8], statecoefs[30][9], statecoefs[30][10], statecoefs[30][11], statecoefs[30][12], statecoefs[30][13], statecoefs[31][1], statecoefs[31][2], statecoefs[31][3], statecoefs[31][4], statecoefs[31][5], statecoefs[31][6], statecoefs[31][7], statecoefs[31][8], statecoefs[31][9], statecoefs[31][10], statecoefs[31][11], statecoefs[31][12], statecoefs[31][13], statecoefs[32][1], statecoefs[32][2], statecoefs[32][3], statecoefs[32][4], statecoefs[32][5], statecoefs[32][6], statecoefs[32][7], statecoefs[32][8], statecoefs[32][9], statecoefs[32][10], statecoefs[32][11], statecoefs[32][12], statecoefs[32][13], statecoefs[33][1], statecoefs[33][2], statecoefs[33][3], statecoefs[33][4], statecoefs[33][5], statecoefs[33][6], statecoefs[33][7], statecoefs[33][8], statecoefs[33][9], statecoefs[33][10], statecoefs[33][11], statecoefs[33][12], statecoefs[33][13], statecoefs[34][1], statecoefs[34][2], statecoefs[34][3], statecoefs[34][4], statecoefs[34][5], statecoefs[34][6], statecoefs[34][7], statecoefs[34][8], statecoefs[34][9], statecoefs[34][10], statecoefs[34][11], statecoefs[34][12], statecoefs[34][13], statecoefs[35][1], statecoefs[35][2], statecoefs[35][3], statecoefs[35][4], statecoefs[35][5], statecoefs[35][6], statecoefs[35][7], statecoefs[35][8], statecoefs[35][9], statecoefs[35][10], statecoefs[35][11], statecoefs[35][12], statecoefs[35][13], statecoefs[36][1], statecoefs[36][2], statecoefs[36][3], statecoefs[36][4], statecoefs[36][5], statecoefs[36][6], statecoefs[36][7], statecoefs[36][8], statecoefs[36][9], statecoefs[36][10], statecoefs[36][11], statecoefs[36][12], statecoefs[36][13], statecoefs[37][1], statecoefs[37][2], statecoefs[37][3], statecoefs[37][4], statecoefs[37][5], statecoefs[37][6], statecoefs[37][7], statecoefs[37][8], statecoefs[37][9], statecoefs[37][10], statecoefs[37][11], statecoefs[37][12], statecoefs[37][13], statecoefs[38][1], statecoefs[38][2], statecoefs[38][3], statecoefs[38][4], statecoefs[38][5], statecoefs[38][6], statecoefs[38][7], statecoefs[38][8], statecoefs[38][9], statecoefs[38][10], statecoefs[38][11], statecoefs[38][12], statecoefs[38][13], statecoefs[39][1], statecoefs[39][2], statecoefs[39][3], statecoefs[39][4], statecoefs[39][5], statecoefs[39][6], statecoefs[39][7], statecoefs[39][8], statecoefs[39][9], statecoefs[39][10], statecoefs[39][11], statecoefs[39][12], statecoefs[39][13], statecoefs[40][1], statecoefs[40][2], statecoefs[40][3], statecoefs[40][4], statecoefs[40][5], statecoefs[40][6], statecoefs[40][7], statecoefs[40][8], statecoefs[40][9], statecoefs[40][10], statecoefs[40][11], statecoefs[40][12], statecoefs[40][13], statecoefs[41][1], statecoefs[41][2], statecoefs[41][3], statecoefs[41][4], statecoefs[41][5], statecoefs[41][6], statecoefs[41][7], statecoefs[41][8], statecoefs[41][9], statecoefs[41][10], statecoefs[41][11], statecoefs[41][12], statecoefs[41][13], statecoefs[42][1], statecoefs[42][2], statecoefs[42][3], statecoefs[42][4], statecoefs[42][5], statecoefs[42][6], statecoefs[42][7], statecoefs[42][8], statecoefs[42][9], statecoefs[42][10], statecoefs[42][11], statecoefs[42][12], statecoefs[42][13], statecoefs[43][1], statecoefs[43][2], statecoefs[43][3], statecoefs[43][4], statecoefs[43][5], statecoefs[43][6], statecoefs[43][7], statecoefs[43][8], statecoefs[43][9], statecoefs[43][10], statecoefs[43][11], statecoefs[43][12], statecoefs[43][13], statecoefs[44][1], statecoefs[44][2], statecoefs[44][3], statecoefs[44][4], statecoefs[44][5], statecoefs[44][6], statecoefs[44][7], statecoefs[44][8], statecoefs[44][9], statecoefs[44][10], statecoefs[44][11], statecoefs[44][12], statecoefs[44][13], statecoefs[45][1], statecoefs[45][2], statecoefs[45][3], statecoefs[45][4], statecoefs[45][5], statecoefs[45][6], statecoefs[45][7], statecoefs[45][8], statecoefs[45][9], statecoefs[45][10], statecoefs[45][11], statecoefs[45][12], statecoefs[45][13], statecoefs[46][1], statecoefs[46][2], statecoefs[46][3], statecoefs[46][4], statecoefs[46][5], statecoefs[46][6], statecoefs[46][7], statecoefs[46][8], statecoefs[46][9], statecoefs[46][10], statecoefs[46][11], statecoefs[46][12], statecoefs[46][13], statecoefs[47][1], statecoefs[47][2], statecoefs[47][3], statecoefs[47][4], statecoefs[47][5], statecoefs[47][6], statecoefs[47][7], statecoefs[47][8], statecoefs[47][9], statecoefs[47][10], statecoefs[47][11], statecoefs[47][12], statecoefs[47][13], statecoefs[48][1], statecoefs[48][2], statecoefs[48][3], statecoefs[48][4], statecoefs[48][5], statecoefs[48][6], statecoefs[48][7], statecoefs[48][8], statecoefs[48][9], statecoefs[48][10], statecoefs[48][11], statecoefs[48][12], statecoefs[48][13], statecoefs[49][1], statecoefs[49][2], statecoefs[49][3], statecoefs[49][4], statecoefs[49][5], statecoefs[49][6], statecoefs[49][7], statecoefs[49][8], statecoefs[49][9], statecoefs[49][10], statecoefs[49][11], statecoefs[49][12], statecoefs[49][13], statecoefs[50][1], statecoefs[50][2], statecoefs[50][3], statecoefs[50][4], statecoefs[50][5], statecoefs[50][6], statecoefs[50][7], statecoefs[50][8], statecoefs[50][9], statecoefs[50][10], statecoefs[50][11], statecoefs[50][12], statecoefs[50][13], statecoefs[51][1], statecoefs[51][2], statecoefs[51][3], statecoefs[51][4], statecoefs[51][5], statecoefs[51][6], statecoefs[51][7], statecoefs[51][8], statecoefs[51][9], statecoefs[51][10], statecoefs[51][11], statecoefs[51][12], statecoefs[51][13], statecoefs[52][1], statecoefs[52][2], statecoefs[52][3], statecoefs[52][4], statecoefs[52][5], statecoefs[52][6], statecoefs[52][7], statecoefs[52][8], statecoefs[52][9], statecoefs[52][10], statecoefs[52][11], statecoefs[52][12], statecoefs[52][13], statecoefs[53][1], statecoefs[53][2], statecoefs[53][3], statecoefs[53][4], statecoefs[53][5], statecoefs[53][6], statecoefs[53][7], statecoefs[53][8], statecoefs[53][9], statecoefs[53][10], statecoefs[53][11], statecoefs[53][12], statecoefs[53][13], statecoefs[54][1], statecoefs[54][2], statecoefs[54][3], statecoefs[54][4], statecoefs[54][5], statecoefs[54][6], statecoefs[54][7], statecoefs[54][8], statecoefs[54][9], statecoefs[54][10], statecoefs[54][11], statecoefs[54][12], statecoefs[54][13], statecoefs[55][1], statecoefs[55][2], statecoefs[55][3], statecoefs[55][4], statecoefs[55][5], statecoefs[55][6], statecoefs[55][7], statecoefs[55][8], statecoefs[55][9], statecoefs[55][10], statecoefs[55][11], statecoefs[55][12], statecoefs[55][13], statelawcoef[1], statelawcoef[2], statelawcoef[3], statelawcoef[4], statelawcoef[5], statelawcoef[6], statelawcoef[7], statelawcoef[8], statelawcoef[9], statelawcoef[10], statelawcoef[11], statelawcoef[12], statelawcoef[13], statelawcoef[14], statelawcoef[15], statelawcoef[16], statelawcoef[17], statelawcoef[18], statelawcoef[19], statelawcoef[20], statelawcoef[21], statelawcoef[22], statelawcoef[23], statelawcoef[24], statelawcoef[25], statelawcoef[26], statelawcoef[27], statelawcoef[28], statelawcoef[29], statelawcoef[30], statelawcoef[31], statelawcoef[32], statelawcoef[33], statelawcoef[34], statelawcoef[35], statelawcoef[36], statelawcoef[37], statelawcoef[38], statelawcoef[39], statelawcoef[40], statelawcoef[41], statelawcoef[42], statelawcoef[43], statelawcoef[44], statelawcoef[45], statelawcoef[46], statelawcoef[47], statelawcoef[48], statelawcoef[49], statelawcoef[50], statelawcoef[51], statelawcoef[52], statelawcoef[53], statelawcoef[54], statelawcoef[55]
internals         = acceptance_rate, hamiltonian_energy, hamiltonian_energy_error, is_accept, log_density, lp, max_hamiltonian_energy_error, n_steps, nom_step_size, numerical_error, step_size, tree_depth
Summary Statistics
 <span class="ansi-bold">         parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold"> naive_se </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">       ess </span> <span class="ansi-bold">   </span> ⋯
 <span class="ansi-bright-black-fg">             Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Fl</span> ⋯
             lawrate    2.8087    1.7432     0.0450    0.0482   1611.3276    0 ⋯
         meanlawcoef    0.0115    0.0430     0.0011    0.0013   1171.1740    1 ⋯
      nationcoefs[1]    0.0454    0.6693     0.0173    0.0119   4509.6864    0 ⋯
      nationcoefs[2]    0.1063    0.6770     0.0175    0.0104   3474.9550    0 ⋯
      nationcoefs[3]    0.0445    0.6676     0.0172    0.0083   4239.3948    0 ⋯
      nationcoefs[4]   -0.1756    0.6736     0.0174    0.0117   5174.1939    0 ⋯
      nationcoefs[5]    0.2191    0.6338     0.0164    0.0125   3560.7361    0 ⋯
      nationcoefs[6]    0.0455    0.6687     0.0173    0.0119   3616.7562    0 ⋯
      nationcoefs[7]   -0.0847    0.6525     0.0168    0.0090   4325.9386    0 ⋯
      nationcoefs[8]   -0.0766    0.6925     0.0179    0.0147   3488.7226    0 ⋯
      nationcoefs[9]   -0.0789    0.6584     0.0170    0.0103   4879.4022    0 ⋯
     nationcoefs[10]   -0.1012    0.6951     0.0179    0.0133   3771.9762    0 ⋯
     nationcoefs[11]   -0.2371    0.6727     0.0174    0.0121   3800.0082    0 ⋯
     nationcoefs[12]    0.1902    0.7024     0.0181    0.0126   3883.0790    0 ⋯
     nationcoefs[13]   -0.0589    0.6733     0.0174    0.0121   4791.5516    0 ⋯
   regioncoefs[1][1]    0.0455    0.1455     0.0038    0.0053    915.0360    0 ⋯
   regioncoefs[1][2]    0.0056    0.1391     0.0036    0.0049    887.1261    1 ⋯
   regioncoefs[1][3]    0.1963    0.1374     0.0035    0.0053    739.1493    1 ⋯
   regioncoefs[1][4]   -0.3116    0.1279     0.0033    0.0047    770.5142    1 ⋯
   regioncoefs[1][5]    0.2675    0.1255     0.0032    0.0049    650.7455    1 ⋯
   regioncoefs[1][6]    0.0857    0.1176     0.0030    0.0053    566.6723    1 ⋯
   regioncoefs[1][7]   -0.1386    0.1237     0.0032    0.0049    689.3163    1 ⋯
   regioncoefs[1][8]   -0.1362    0.1167     0.0030    0.0041    773.5224    1 ⋯
          ⋮               ⋮         ⋮         ⋮          ⋮          ⋮          ⋱
<span class="ansi-cyan-fg">                                                   1 column and 922 rows omitted</span>
Quantiles
 <span class="ansi-bold">         parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">             Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>
             lawrate    0.5643    1.4218    2.4587    3.7840    6.9214
         meanlawcoef   -0.0757   -0.0165    0.0119    0.0418    0.0912
      nationcoefs[1]   -1.2758   -0.3997    0.0410    0.5035    1.3141
      nationcoefs[2]   -1.1713   -0.3666    0.0981    0.5606    1.3667
      nationcoefs[3]   -1.2168   -0.3970    0.0395    0.4744    1.4215
      nationcoefs[4]   -1.5332   -0.6247   -0.1857    0.2696    1.1986
      nationcoefs[5]   -1.0214   -0.2156    0.2235    0.6298    1.4570
      nationcoefs[6]   -1.2468   -0.3962    0.0414    0.5116    1.2780
      nationcoefs[7]   -1.4074   -0.5196   -0.0850    0.3639    1.1992
      nationcoefs[8]   -1.3601   -0.5607   -0.0873    0.3808    1.2965
      nationcoefs[9]   -1.3918   -0.5245   -0.0714    0.3790    1.2148
     nationcoefs[10]   -1.4440   -0.5720   -0.0998    0.3528    1.2762
     nationcoefs[11]   -1.5324   -0.6804   -0.2417    0.2420    1.0584
     nationcoefs[12]   -1.2364   -0.2759    0.1701    0.6653    1.5755
     nationcoefs[13]   -1.3574   -0.4996   -0.0728    0.4052    1.2114
   regioncoefs[1][1]   -0.2364   -0.0540    0.0442    0.1465    0.3246
   regioncoefs[1][2]   -0.2565   -0.0905    0.0007    0.1011    0.2876
   regioncoefs[1][3]   -0.0709    0.1004    0.1989    0.2941    0.4571
   regioncoefs[1][4]   -0.5590   -0.3974   -0.3110   -0.2251   -0.0640
   regioncoefs[1][5]    0.0114    0.1853    0.2713    0.3527    0.5062
   regioncoefs[1][6]   -0.1377    0.0041    0.0868    0.1655    0.3144
   regioncoefs[1][7]   -0.3856   -0.2219   -0.1316   -0.0539    0.0937
   regioncoefs[1][8]   -0.3768   -0.2138   -0.1338   -0.0588    0.0854
          ⋮               ⋮         ⋮         ⋮         ⋮         ⋮
<span class="ansi-cyan-fg">                                                        922 rows omitted</span>
</pre>
</div>
</div>
</div>
</section>
<section id="shall-issue-coefficients" class="level1">
<h1>Shall Issue coefficients</h1>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotlawts</span>(sisam, silawdates,modeljoined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>State law coefficient values</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-13-output-2.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-13-output-3.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Each state shown with its locally estimated counterfactual (orange), actual (dark blue), and date of CC law if any (red vertical)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="USCarry_files/figure-html/cell-13-output-5.svg" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<p><img src="USCarry_files/figure-html/cell-13-output-6.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="the-take-home" class="level1">
<h1>The Take Home</h1>
<section id="permitlessconstitutional-carry-laws" class="level2">
<h2 class="anchored" data-anchor-id="permitlessconstitutional-carry-laws">Permitless/Constitutional Carry laws</h2>
<p>Many states that have passed constitutional carry laws have done so recently enough that there is no data on homicides available from CDC Wonder yet.</p>
<p>For those which passed the law long enough ago to have some post-law data, still many of them were in the last few years leaving only a few years of post-law data. The last few years is a time period where homicides have increased nearly nationwide and it is challenging to estimate the effect of a law when it is imposed on top of a nonlinearly changing trend. Estimates of a law effect created by comparing the actual data to counterfactuals estimated as small perturbations to the regional trend lead to estimates of the average law coefficient that has uncertain sign, with a most likely value of about 0.05 or so, meaning that gun homicides may increase by a factor of around 1.05, however the ability to resolve this number is so poor that the number could be anything from about -0.1 to +0.25 (multiplying the crime rate by anywhere from 0.9 to 1.28.</p>
<p>Any kind of convincing evidence for a consistent average net positive or negative effect of passing constitutional carry laws simply isn’t there. What’s more, we have decent bounds on the size of this effect for most states, it should be somewhere between perhaps -0.25 and 0.25 on the log scale, meaning approximately the rate of homicides would be multiplied by some number in the range 0.78 to 1.28.</p>
</section>
<section id="shall-issue-laws" class="level2">
<h2 class="anchored" data-anchor-id="shall-issue-laws">Shall issue laws</h2>
<p>Because many shall-issue laws were passed in the 1990’s there is much better evidence for their long term effect on crime. However, using the same methodology as above the average effect is essentially symmetrically distributed around 0.0 with a posterior credible range of about -0.1 to 0.1. The only reasonably strong evidence we have in this data for a real effect is that Texas may have reduced crime with a coefficient around -0.3 and perhaps Pennsylvania caused an increase around 0.2, with Wisconsin possibly around 0.2. The PA estimate does see the counterfactual diverge around the time of the law, but the Wisconsin counterfactual diverges 20 years before the law, suggesting that that effect is really an artifact of a poor counterfactual estimate.</p>
</section>
<section id="firearms-sales" class="level2">
<h2 class="anchored" data-anchor-id="firearms-sales">Firearms Sales</h2>
<p>Firearms sales are driven by multiple factors. One is the fear of “bans” which drove a lot of sales around the time of the Sandy Hook school shooting in Dec 2012. And in general sales have increased over the last decade including a sudden increase after the turmoil of 2020, with women and racial minorities making up a historically unprecedented fraction of new sales (<a href="https://www.wsj.com/articles/women-are-nearly-half-of-new-gun-buyers-study-finds-11631792761">close to 50%</a>).</p>
<p>Firearms sales can plausibly be both a cause of firearms crime (when people purchase firearms to commit crime), a response to violence (when people purchase firearms for defense after periods of crime), and even in some cases a deterrent to crime (when criminals meet with greater defensive responses than before). It is hard to say which of these effects dominates, and in fact most likely all of these occur at different times and different places. One thing is clear however, and that is that it is entirely possible for gun ownership to increase while crime decreases, or for crime to increase while gun ownership per capita decreases. Those who somehow wish to draw a direct causal link in the US between more guns and more gun crime simply do not have an easy obvious convincing argument.</p>
<p>The evidence suggests that in the post <em>NYSRPA v Bruen</em> era, forcing CA and NY and others to shall-issue their permits will by itself have very little effect on overall gun crime. More likely if there is an increase it will be due to the turmoil undergoing the whole country at the moment, with high levels of inflation and the war in Ukraine driving food prices up and crime in general increasing over the last few years.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>