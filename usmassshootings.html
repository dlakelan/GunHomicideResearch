<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>usmassshootings</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="usmassshootings_files/libs/clipboard/clipboard.min.js"></script>
<script src="usmassshootings_files/libs/quarto-html/quarto.js"></script>
<script src="usmassshootings_files/libs/quarto-html/popper.min.js"></script>
<script src="usmassshootings_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="usmassshootings_files/libs/quarto-html/anchor.min.js"></script>
<link href="usmassshootings_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="usmassshootings_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="usmassshootings_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="usmassshootings_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="usmassshootings_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="mass-shootings-in-usa" class="level1">
<h1>Mass shootings in USA</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">activate</span>(<span class="st">"."</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CSV</span>,<span class="bu">DataFrames</span>,<span class="bu">StatsPlots</span>,<span class="bu">Dates</span>,<span class="bu">Loess</span>,<span class="bu">DataFramesMeta</span>,<span class="bu">StatsBase</span>,<span class="bu">GLM</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>sdata <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"data/FBIShooterDB.csv"</span>,DataFrame)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The above data set was hand transcribed from the FBI PDF files available in the data directory. The original is the .ods spreadsheet file. The csv is exported from there. Please report any transcription errors you detect!</p>
<pre class="julia{results=&quot;hidden&quot;}"><code>
weirddates = [i for i in 2:nrow(sdata) if sdata[i,:Date] &lt; sdata[i-1,:Date]  ]


sdata.yearmon = tuple.(year.(sdata.Date),month.(sdata.Date))
sdata.year = year.(sdata.Date)

yearmon2date(x) = Date(x[1],x[2],15)
@subset!(sdata,.! ismissing.(:NShotgun) .&amp;&amp; .!ismissing.(:NHandgun) .&amp;&amp; .!ismissing.(:NRifle) .&amp;&amp; .!ismissing.(:NKilled) .&amp;&amp; .!ismissing.(:Motive))

sdatamon = @by(sdata,
    :yearmon,:TotKilled = sum(:NKilled),:HGKilled = sum(:NKilled .* (:NHandgun .&gt; 0 .&amp;&amp; :NRifle .==0 .&amp;&amp; :NShotgun .== 0)),
    :RifleKilled = sum(:NKilled .* (:NHandgun .== 0 .&amp;&amp; :NRifle .&gt; 0 .&amp;&amp; :NShotgun .== 0)),
    :ShotgunKilled = sum(:NKilled .* (:NHandgun .== 0 .&amp;&amp; :NRifle .== 0 .&amp;&amp; :NShotgun .&gt; 0)),
    :MixedKilled = sum(:NKilled .* ( (:NHandgun .&gt; 0 .&amp;&amp; :NRifle .== 0 .&amp;&amp; :NShotgun .&gt; 0) .|| 
                                     (:NHandgun .&gt; 0 .&amp;&amp; :NRifle .&gt; 0 .&amp;&amp; :NShotgun .== 0) .|| 
                                     (:NHandgun .== 0 .&amp;&amp; :NRifle .&gt; 0 .&amp;&amp; :NShotgun .&gt; 0) .||
                                     (:NHandgun .&gt; 0 .&amp;&amp; :NRifle .&gt; 0 .&amp;&amp; :NShotgun .&gt; 0))),
    :EdDeaths = sum(:NKilled .* (:LocType .== "Education")),
    :CommDeaths = sum(:NKilled .* (:LocType .== "Commerce")),
    :GovDeaths = sum(:NKilled .* (:LocType .== "Government")),
    :DWDeaths = sum(:NKilled .* (:Motive .== "Disgruntled Worker")),
    :DSDeaths = sum(:NKilled .* (:Motive .== "Disgruntled Student")),
    :RelDeaths = sum(:NKilled .* (:Motive .== "Relationship")),
    :PubShoots = sum(:NKilled .* (:Motive .== "Public Shooter")),
    :PubShootsHG = sum(:NKilled .* (:Motive .== "Public Shooter" .&amp;&amp; :NRifle .== 0 .&amp;&amp; :NShotgun .== 0 .&amp;&amp; :NHandgun .&gt; 0)),
    :PubShootsRi = sum(:NKilled .* (:Motive .== "Public Shooter" .&amp;&amp; :NRifle .&gt; 0)),
    :ShootCountHG = sum(:NHandgun .&gt; 0 .&amp;&amp; (:NRifle .+ :NShotgun) .== 0),
    :ShootCountAll = length(:NKilled))


sdatamon.Year = getindex.(sdatamon.yearmon,1)
</code></pre>
</section>
<section id="using-summary-tables" class="level1">
<h1>Using Summary Tables</h1>
<p>There are a variety of interesting summaries of the data. By grouping by month in <code>sdatamon</code> we can look at cumulative totals, rates of change, split by types etc.</p>
<p>For example, we can compare how many people were killed with each type of weapon.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> sdatamon <span class="fu">plot</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>HGKilled),label<span class="op">=</span><span class="st">"Handguns"</span>,legend<span class="op">=:</span>topleft,title<span class="op">=</span><span class="st">"Killings via Various Armaments"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> sdatamon <span class="fu">plot!</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>MixedKilled),label<span class="op">=</span><span class="st">"Mixed"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> sdatamon <span class="fu">plot!</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>RifleKilled),label<span class="op">=</span><span class="st">"Rifles"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> sdatamon <span class="fu">plot!</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>ShotgunKilled),label<span class="op">=</span><span class="st">"Shotguns"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Another interesting question is how does the motivation/type of event break down. We see that while a steady stream of disgruntled workers, students, and ex-husbands commit murder at an approximately constant rate, there has been a much more serious exponential type rise in public shooting deaths over the timeperiod.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> sdatamon <span class="fu">plot</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>DWDeaths),label<span class="op">=</span><span class="st">"Disgruntled Worker Deaths"</span>,legend<span class="op">=:</span>topleft,title<span class="op">=</span><span class="st">"Killings by Motivation/Type"</span>,ylab<span class="op">=</span><span class="st">"Cumulative Deaths"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> sdatamon <span class="fu">plot!</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>DSDeaths),label<span class="op">=</span><span class="st">"Disgruntled Student Deaths"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> sdatamon <span class="fu">plot!</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>RelDeaths),label<span class="op">=</span><span class="st">"Relationship Deaths"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> sdatamon <span class="fu">plot!</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>PubShoots),label<span class="op">=</span><span class="st">"Public Shootings"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> sdatamon <span class="fu">plot</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>PubShootsHG),label<span class="op">=</span><span class="st">"Handgun Only Public Killings"</span>,legend<span class="op">=:</span>topleft,title<span class="op">=</span><span class="st">"Public Killings by Weapon"</span>,ylab<span class="op">=</span><span class="st">"Cumulative Deaths"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> sdatamon <span class="fu">plot!</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>PubShootsRi),label<span class="op">=</span><span class="st">"Rifle+ Public Killings"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> sdatamon <span class="fu">plot</span>(<span class="fu">map</span>(x <span class="op">-&gt;</span> <span class="fu">Date</span>.(x[<span class="fl">1</span>],x[<span class="fl">2</span>],<span class="fl">15</span>),<span class="op">:</span>yearmon),<span class="fu">log</span>.(<span class="fu">cumsum</span>(<span class="op">:</span>PubShoots)),title<span class="op">=</span><span class="st">"log(Public Shootings)"</span>,legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The exponential growth is not just exponential growth in victim count, but actually shows near exponential growth in event count, with Handgun only events making up a nearly constant 60% or so of all events.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> sdatamon <span class="fu">plot</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>ShootCountAll),label<span class="op">=</span><span class="st">"All Events"</span>,title<span class="op">=</span><span class="st">"Cumulative Event Count"</span>,legend<span class="op">=:</span>topleft)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> sdatamon <span class="fu">plot!</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>ShootCountHG),label<span class="op">=</span><span class="st">"Handgun Events"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> sdatamon <span class="fu">plot</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">log</span>.(<span class="fu">cumsum</span>(<span class="op">:</span>ShootCountAll)),label<span class="op">=</span><span class="st">"All Events"</span>,title<span class="op">=</span><span class="st">"log(Cumulative Event Count)"</span>,legend<span class="op">=:</span>topleft)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> sdatamon <span class="fu">plot!</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">log</span>.(<span class="fu">cumsum</span>(<span class="op">:</span>ShootCountHG)),label<span class="op">=</span><span class="st">"Handgun Events"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> sdatamon <span class="fu">plot</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>ShootCountHG) <span class="op">./</span> <span class="fu">cumsum</span>(<span class="op">:</span>ShootCountAll),label<span class="op">=</span><span class="st">"Fraction Handgun"</span>,title<span class="op">=</span><span class="st">"Fraction of Events that are Handgun Only"</span>,legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="where-do-events-occur" class="level1">
<h1>Where do events occur?</h1>
<p>Although School shootings get the most press, in fact most active shooter events take place at commerce locations such as malls, big box stores, restaurants, and similar.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> sdatamon <span class="fu">plot</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>CommDeaths),label<span class="op">=</span><span class="st">"Commerce"</span>,legend<span class="op">=:</span>topleft,title<span class="op">=</span><span class="st">"Killings by Location"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> sdatamon <span class="fu">plot!</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>EdDeaths),label<span class="op">=</span><span class="st">"Education"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> sdatamon <span class="fu">plot!</span>(<span class="fu">map</span>(yearmon2date,<span class="op">:</span>yearmon),<span class="fu">cumsum</span>(<span class="op">:</span>GovDeaths),label<span class="op">=</span><span class="st">"Government"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Thankfully, most events involve less than 10 people dead. And there are not obvious differences in the distribution of deaths by firearm type. The three highest death count events are the Las Vegas shooting at the Harvest music festival (58 dead), the Orlando Nightclub Shooting (49 dead), and the Virginia Tech shooting (32 dead). The Las Vegas shooting involved many weapons but principally semi-automatic rifles, the Orlando shooter was armed with both a semi-automatic rifle and a semi-automatic pistol, and the Virginia Tech shooter was armed with 9mm and 22LR handguns. Although the extreme events get the most attention, in the bulk of the distribution, there are not clear reasons to think that one or another type of firearm conveys an advantage to the shooter.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">histogram</span>(sdata.NKilled,bins<span class="op">=-</span><span class="fl">0.5</span><span class="op">:</span><span class="fl">1.0</span><span class="op">:</span><span class="fl">75.5</span>,title<span class="op">=</span><span class="st">"Deaths Per Incident"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">histogram</span>(<span class="pp">@subset</span>(sdata,<span class="op">:</span>NRifle <span class="op">.&gt;</span> <span class="fl">0</span>).NKilled,bins<span class="op">=-</span><span class="fl">0.5</span><span class="op">:</span><span class="fl">1.0</span><span class="op">:</span><span class="fl">75.5</span>,title<span class="op">=</span><span class="st">"Deaths Per Incident"</span>,label<span class="op">=</span><span class="st">"Had Rifle"</span>,alpha<span class="op">=</span><span class="fl">0.25</span>,normalize<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram!</span>(<span class="pp">@subset</span>(sdata,<span class="op">:</span>NHandgun <span class="op">.&gt;</span> <span class="fl">0</span>).NKilled,bins<span class="op">=-</span><span class="fl">0.5</span><span class="op">:</span><span class="fl">1.0</span><span class="op">:</span><span class="fl">75.5</span>,title<span class="op">=</span><span class="st">"Deaths Per Incident"</span>,label<span class="op">=</span><span class="st">"Had Handgun"</span>,alpha<span class="op">=</span><span class="fl">0.25</span>,normalize<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram!</span>(<span class="pp">@subset</span>(sdata,<span class="op">:</span>NShotgun <span class="op">.&gt;</span> <span class="fl">0</span>).NKilled,bins<span class="op">=-</span><span class="fl">0.5</span><span class="op">:</span><span class="fl">1.0</span><span class="op">:</span><span class="fl">75.5</span>,title<span class="op">=</span><span class="st">"Deaths Per Incident"</span>,label<span class="op">=</span><span class="st">"Had Shotgun"</span>,alpha<span class="op">=</span><span class="fl">0.25</span>,normalize<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">histogram</span>(<span class="pp">@subset</span>(sdata,<span class="op">:</span>NRifle <span class="op">.&gt;</span> <span class="fl">0</span>).NKilled,bins<span class="op">=-</span><span class="fl">0.5</span><span class="op">:</span><span class="fl">1.0</span><span class="op">:</span><span class="fl">75.5</span>,title<span class="op">=</span><span class="st">"Deaths Per Incident"</span>,label<span class="op">=</span><span class="st">"Had Rifle"</span>,alpha<span class="op">=</span><span class="fl">0.25</span>,normalize<span class="op">=</span><span class="cn">true</span>,xlim<span class="op">=</span>(<span class="fl">0</span>,<span class="fl">20</span>))</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram!</span>(<span class="pp">@subset</span>(sdata,<span class="op">:</span>NHandgun <span class="op">.&gt;</span> <span class="fl">0</span>).NKilled,bins<span class="op">=-</span><span class="fl">0.5</span><span class="op">:</span><span class="fl">1.0</span><span class="op">:</span><span class="fl">75.5</span>,title<span class="op">=</span><span class="st">"Deaths Per Incident"</span>,label<span class="op">=</span><span class="st">"Had Handgun"</span>,alpha<span class="op">=</span><span class="fl">0.25</span>,normalize<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram!</span>(<span class="pp">@subset</span>(sdata,<span class="op">:</span>NShotgun <span class="op">.&gt;</span> <span class="fl">0</span>).NKilled,bins<span class="op">=-</span><span class="fl">0.5</span><span class="op">:</span><span class="fl">1.0</span><span class="op">:</span><span class="fl">75.5</span>,title<span class="op">=</span><span class="st">"Deaths Per Incident"</span>,label<span class="op">=</span><span class="st">"Had Shotgun"</span>,alpha<span class="op">=</span><span class="fl">0.25</span>,normalize<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="how-many-people-are-killed-or-injured-typically" class="level1">
<h1>How many people are killed or injured typically?</h1>
<p>Looking at cumulative distribution functions, the vast majority of events involve fewer people killed or injured than can be generated with one of the most commonly owned firearms for example the Glock 17 handgun with two 17 round magazines.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> sdata <span class="fu">plot</span>(<span class="fu">ecdf</span>(<span class="op">:</span>NKilled),legend<span class="op">=</span><span class="cn">false</span>,title<span class="op">=</span><span class="st">"ECDF of Death Count"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> sdata <span class="fu">plot</span>(<span class="fu">ecdf</span>(<span class="op">:</span>NInjured),legend<span class="op">=</span><span class="cn">false</span>,title<span class="op">=</span><span class="st">"ECDF of Injured Count"</span>,xlim<span class="op">=</span>(<span class="fl">0</span>,<span class="fl">100</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>ee <span class="op">=</span> <span class="pp">@df</span> sdata <span class="fu">ecdf</span>(<span class="op">:</span>NKilled <span class="op">.+</span> <span class="op">:</span>NInjured)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">plot</span>(ee,legend<span class="op">=</span><span class="cn">false</span>,title<span class="op">=</span><span class="st">"ECDF of Killed+Injured Count"</span>,xlim<span class="op">=</span>(<span class="fl">0</span>,<span class="fl">100</span>),label<span class="op">=</span><span class="st">"Total Killed + Injured"</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>([<span class="fl">17</span><span class="op">*</span><span class="fl">2.0</span>,<span class="fl">17</span><span class="op">*</span><span class="fl">2.0</span>],[<span class="fl">0.0</span>,<span class="fl">1.0</span>],label<span class="op">=</span><span class="st">"Glock + 2 Standard Magazines"</span>,legend<span class="op">=:</span>bottomright)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(<span class="fl">17</span><span class="op">*</span><span class="fl">2</span><span class="op">+</span><span class="fl">1</span>,<span class="fu">ee</span>(<span class="fl">17</span><span class="op">*</span><span class="fl">2</span>) <span class="op">-</span> <span class="fl">.1</span>,<span class="fu">text</span>(<span class="st">"</span><span class="sc">$</span>(<span class="fu">round</span>(<span class="fu">ee</span>(<span class="fl">17.2</span>)<span class="op">*</span><span class="fl">100</span>))<span class="st">% less than </span><span class="sc">$</span>(<span class="fl">17</span><span class="op">*</span><span class="fl">2</span>)<span class="st"> casualties"</span>,<span class="fl">8</span>,halign<span class="op">=:</span>left))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="what-could-cause-exponential-growth-in-public-shootings" class="level1">
<h1>What could cause exponential growth in public shootings?</h1>
<p>Evidently we have near exponential growth in public shootings. What are some hypotheses about why that might be?</p>
<p>One way to get exponential growth is via “contagion”. By now most people are familiar with “viral videos” or re-tweets or the basic reproduction number of COVID. In this mechanism whenever one person commits an event, it convinces on average a little more than 1 more person to commit an event within the next short time period. This is sometimes called <a href="https://en.wikipedia.org/wiki/Mass_shooting_contagion">“Mass Shooting Contagion”</a>.</p>
<p>Although there can be no question that some of these events are motivated by desire for fame and to be like previous perpetrators (we know this due to investigations into the actions of mass shooters leading up to their event), it seems unlikely to be the sole effect leading to exponential type increases. In particular, many of the events do not involve the choice of a particularly notable location, nor do they involve apparent planning for notariety. For example the following three events transcribed from the FBI list which are somewhat “typical” and do not indicate the grandiose plans similar to the Columbine, Virginia Tech, Sandy Hook, or Las Vegas Festival events.</p>
<section id="economic-motives" class="level2">
<h2 class="anchored" data-anchor-id="economic-motives">Economic Motives</h2>
<p>Although individual</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ginidat <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"data/API_SI.POV.GINI_DS2_en_csv_v2_4333947.csv"</span>,DataFrame; skipto<span class="op">=</span><span class="fl">6</span>, header<span class="op">=</span><span class="fl">5</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ginidat <span class="op">=</span> ginidat[<span class="op">:</span>,<span class="fl">1</span><span class="op">:</span><span class="kw">end</span><span class="op">-</span><span class="fl">1</span>] <span class="co"># drop meaningless final column</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rename!</span>(ginidat,<span class="fu">Dict</span>(<span class="fu">Symbol</span>(<span class="st">"Country Name"</span>) <span class="op">=&gt;</span> <span class="op">:</span>Country, <span class="fu">Symbol</span>(<span class="st">"Country Code"</span>) <span class="op">=&gt;</span> <span class="op">:</span>countrycode, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Symbol</span>(<span class="st">"Indicator Name"</span>) <span class="op">=&gt;</span> <span class="op">:</span>indicator, <span class="fu">Symbol</span>(<span class="st">"Indicator Code"</span>) <span class="op">=&gt;</span> <span class="op">:</span>indicatorcode))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ginistack <span class="op">=</span> DataFramesMeta.<span class="fu">stack</span>(ginidat,<span class="fu">Not</span>([<span class="op">:</span>Country, <span class="op">:</span>countrycode,<span class="op">:</span>indicator,<span class="op">:</span>indicatorcode]))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rename!</span>(ginistack,<span class="fu">Dict</span>(<span class="st">"variable"</span> <span class="op">=&gt;</span> <span class="st">"Year"</span>, <span class="st">"value"</span> <span class="op">=&gt;</span> <span class="st">"ginicoef"</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>ginistack.Year <span class="op">=</span> <span class="fu">tryparse</span>.(<span class="dt">Int64</span>,ginistack.Year)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>usgini <span class="op">=</span> <span class="pp">@subset</span>(ginistack,<span class="op">:</span>countrycode <span class="op">.==</span> <span class="st">"USA"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>ginishootmon <span class="op">=</span> <span class="pp">@orderby</span>(<span class="fu">leftjoin</span>(sdatamon,usgini, on <span class="op">=</span> <span class="op">:</span>Year),<span class="op">:</span>yearmon)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> ginishootmon <span class="fu">scatter</span>(<span class="op">:</span>ginicoef,<span class="fu">log</span>.(<span class="fu">cumsum</span>(<span class="op">:</span>PubShoots)),title<span class="op">=</span><span class="st">"Public Shootings vs Gini"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="how-do-suicides-track-active-shootings" class="level1">
<h1>How do suicides track active shootings</h1>
<p>Many active shootings are explicitly a form of suicide. The shooter has no intention of surviving, and intends to lash out as their last action. If this is true, then perhaps the things that drive mass shootings also drive suicide increases of other forms? Also, mass shootings are overwhelmingly committed by male perpetrators, so we will look at male suicide rates.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>suic <span class="op">=</span> <span class="pp">@select</span>(<span class="pp">@subset</span>(CSV.<span class="fu">read</span>(<span class="st">"data/who-suicide-data.csv"</span>,DataFrame; select <span class="op">=</span> [<span class="op">:</span>SpatialDimValueCode,<span class="op">:</span><span class="dt">Period</span>,<span class="op">:</span>Dim1,<span class="op">:</span>FactValueNumeric]), </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                        <span class="op">:</span>SpatialDimValueCode <span class="op">.==</span> <span class="st">"USA"</span> <span class="op">.&amp;&amp;</span> <span class="op">:</span>Dim1 <span class="op">.==</span> <span class="st">"Male"</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                        <span class="op">:</span>Year <span class="op">=</span> <span class="op">:</span><span class="dt">Period</span>, <span class="op">:</span>Country <span class="op">=</span> <span class="op">:</span>SpatialDimValueCode, <span class="op">:</span>SuicRate <span class="op">=</span> <span class="op">:</span>FactValueNumeric)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> suic <span class="fu">scatter</span>(<span class="op">:</span>Year, <span class="op">:</span>SuicRate,ylab<span class="op">=</span><span class="st">"Male Suicide/100k/yr"</span>,xlab<span class="op">=</span><span class="st">"Year"</span>,legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>pubshoots <span class="op">=</span> <span class="pp">@by</span>(sdata,<span class="op">:</span>year,<span class="op">:</span>ShootCount <span class="op">=</span> <span class="fu">sum</span>(<span class="op">:</span>Motive <span class="op">.==</span> <span class="st">"Public Shooter"</span>))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>suicandshoots <span class="op">=</span> <span class="fu">leftjoin</span>(suic,pubshoots; on <span class="op">=</span> <span class="op">:</span>Year <span class="op">=&gt;</span> <span class="op">:</span>year)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> suicandshoots <span class="fu">plot</span>(<span class="op">:</span>Year,<span class="op">:</span>ShootCount;title<span class="op">=</span><span class="st">"Public Shooting Counts"</span>, legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> suicandshoots <span class="fu">scatter</span>(<span class="op">:</span>SuicRate, <span class="op">:</span>ShootCount;xlab<span class="op">=</span><span class="st">"Male Suicide Rate / 100k/yr"</span>,ylab<span class="op">=</span><span class="st">"Public Shooting Count"</span>,legend<span class="op">=</span><span class="cn">false</span>,title<span class="op">=</span><span class="st">"US Shooting Count vs Suicide Rate"</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>suicmod <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(ShootCount <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> SuicRate),suicandshoots)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>Plots.<span class="fu">abline!</span>(<span class="fu">coef</span>(suicmod)[<span class="fl">2</span>],<span class="fu">coef</span>(suicmod)[<span class="fl">1</span>])</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(suicmod))</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="fu">std</span>(<span class="fu">residuals</span>(suicmod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>